import{_ as de}from"./TablePagination-BkA5oPvl.js";import{_ as pe}from"./AppDateTimePicker-BUR4wdpg.js";import{_ as ve}from"./AppTextField-CO1OCl8j.js";import{_ as ce}from"./AppSelect-BORXVmn9.js";import{r as n,E as fe,w as ye,V as _e,c as Ve,b as a,e as o,i as be,a as we,o as G,s as i,d as m,ae as $,Z as f,t as z,a_ as ge,l as ke,f as J,k as xe}from"./main-CGIGvtjp.js";import Pe from"./AddPaymentDrawer-DFPZJUlE.js";import Ce from"./EditPaymentDrawer-BrnIjDYd.js";import{$ as D}from"./api-wPfYMxig.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as K,a as De,b as L,d as Te}from"./VCard-BaQUfnfA.js";import{V as Ue}from"./VSnackbar-DRNdSwGL.js";import{V as Be}from"./VDialog-CuzZWw8U.js";import{V as W}from"./VCardText-CKM6YoM2.js";import{V as X}from"./VSpacer-C2OTd3ev.js";import{V as Ee}from"./VDivider-CiVFgY8R.js";import{V as Se}from"./VDataTableServer-BetegY5r.js";import"./VPagination-B39xpbsL.js";import"./VField-hgnJTDHf.js";import"./form-DLJXrUR1.js";import"./easing-Bybner-F.js";import"./VInput-od_ZqPBf.js";import"./VImg-y3_Dq59X.js";import"./VTextField-BDtxKLE7.js";/* empty css                   */import"./VCounter-4fURVq-I.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-CBYEa1fs.js";import"./VList-tu7DKytm.js";import"./ssrBoot-B53t9Zp2.js";import"./VAvatar-d42EKptl.js";import"./dialog-transition-Dn78FB-K.js";import"./VMenu-Dqb_9Nbi.js";import"./VOverlay-5WpuzIO0.js";import"./delay-B-1e8ADS.js";import"./lazy-CuuBpfoG.js";import"./scopeId-pB8N1Z-v.js";import"./VCheckboxBtn-C6_B7Nci.js";import"./VSelectionControl-CyEpDfWN.js";import"./VChip-OvwQEkrW.js";import"./VSlideGroup-Dw1TjT_V.js";import"./AppDrawerHeaderSection-CjzXVESl.js";import"./vue3-perfect-scrollbar-CPnMYYVW.js";import"./VNavigationDrawer-CFHcDGLE.js";import"./VForm-BLOGgPit.js";import"./VRow-CpxoGJeY.js";/* empty css              */import"./index-CvOPxmL5.js";import"./VDataTable-Yy7LIdN2.js";import"./VTable-C1PsfVtj.js";import"./filter-D1hx86lB.js";const Ie={class:"me-3 d-flex gap-3"},Ae={style:{"min-width":"200px"}},Oe={style:{"min-width":"180px"}},Ne={style:{"min-width":"160px"}},he={style:{"min-width":"160px"}},Me=["onClick"],Re={__name:"index",setup(Fe){const Q=be(),y=n(""),_=n(null),V=n(null),b=n(null),w=n(null),g=n(null),T=n([]),Y=async()=>{var l;try{const e=await D("/plans",{method:"GET",params:{per_page:200}});e&&e.status==="success"?T.value=Array.isArray(e.data)?e.data:((l=e.data)==null?void 0:l.data)??e.data??[]:T.value=[]}catch(e){console.error("Error fetching plans",e),T.value=[]}},d=n(10),p=n(1),O=n(),N=n(),U=n([]),ee=l=>{var e,s,r,u;O.value=(s=(e=l.sortBy)==null?void 0:e[0])==null?void 0:s.key,N.value=(u=(r=l.sortBy)==null?void 0:r[0])==null?void 0:u.order},B=n(!1),Z=n(""),E=n("success"),v=(l,e="success")=>{Z.value=l,E.value=e,B.value=!0},k=n(!1),S=n(null),te=l=>{S.value=l,k.value=!0},ae=async()=>{S.value&&(await ie(S.value),k.value=!1,S.value=null)},le=[{title:"المستخدم",key:"user_name"},{title:"الباقة",key:"plan_name"},{title:"المبلغ",key:"amount"},{title:"طريقة الدفع",key:"payment_method"},{title:"الحالة",key:"status"},{title:"تاريخ الدفع",key:"paid_at"},{title:"العمليات",key:"actions",sortable:!1}],I=n([]),x=n(0),h=n(!0),P=async()=>{var l;h.value=!0;try{const e={search:y.value||void 0,plan_id:_.value||void 0,status:V.value||void 0,payment_method:b.value||void 0,paid_from:w.value||void 0,paid_to:g.value||void 0,per_page:d.value,page:p.value,sort_by:O.value||void 0,sort_order:N.value||void 0},s=await D("/payments",{method:"GET",params:e});s&&s.status==="success"?(I.value=(s.data||[]).map(r=>{var u,c,A,t;return{...r,user_name:((c=(u=r.subscription)==null?void 0:u.user)==null?void 0:c.name)??r.user_name??"-",plan_name:((t=(A=r.subscription)==null?void 0:A.plan)==null?void 0:t.name)??r.plan_name??"-"}}),x.value=((l=s.meta)==null?void 0:l.total)||0):(I.value=[],x.value=0)}catch(e){console.error("Error fetching payments",e),I.value=[],x.value=0}finally{h.value=!1}};fe(async()=>{await Y(),P()}),ye([y,_,V,b,w,g,d,p,O,N],()=>{p.value=1,P()});const oe=_e(()=>I.value),M=n(!1),ne=async l=>{try{await D("/payments/store",{method:"POST",body:l}),v("تم إضافة الدفع بنجاح","success"),P()}catch{v("حدث خطأ، حاول مرة أخرى","error")}},R=n(!1),j=n(null),se=l=>{j.value=l,R.value=!0},re=async(l,e)=>{try{await D(`/payments/update/${l}`,{method:"POST",body:e}),v("تم تعديل الدفع بنجاح","success"),P()}catch{v("حدث خطأ، حاول مرة أخرى","error")}},ie=async l=>{try{await D(`/payments/delete/${l}`,{method:"POST"});const e=U.value.findIndex(s=>s===l);e!==-1&&U.value.splice(e,1),v("تم حذف الدفع بنجاح","success"),P()}catch{v("حدث خطأ أثناء الحذف","error")}},ue=l=>{Q.push(`/admin/subscriptions/${l}`)},me=()=>{y.value="",_.value=null,V.value=null,b.value=null,w.value=null,g.value=null};return(l,e)=>{const s=ce,r=ve,u=pe,c=we("IconBtn"),A=de;return G(),Ve("section",null,[a(K,{class:"mb-6"},{default:o(()=>[a(De,{class:"pb-4"},{default:o(()=>[a(L,null,{default:o(()=>e[18]||(e[18]=[i("المدفوعات")])),_:1,__:[18]})]),_:1}),a(W,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[m("div",Ie,[a(s,{label:"عرض","model-value":d.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=parseInt(t,10))},null,8,["model-value","items"])]),m("div",Ae,[a(r,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"بحث باسم المستخدم",label:"بحث"},null,8,["modelValue"])]),m("div",Oe,[a(s,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),items:T.value,"item-value":"id","item-title":"name",label:"الباقة",clearable:"",placeholder:"اختر باقة"},null,8,["modelValue","items"])]),m("div",Ne,[a(s,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),items:[{value:"pending",title:"قيد الانتظار"},{value:"completed",title:"مكتمل"},{value:"failed",title:"فشل"}],"item-value":"value","item-title":"title",label:"الحالة",clearable:"",placeholder:"اختر حالة"},null,8,["modelValue"])]),m("div",he,[a(s,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),items:[{value:"credit_card",title:"بطاقة ائتمان"},{value:"bank_transfer",title:"تحويل بنكي"},{value:"paypal",title:"باي بال"},{value:"cash",title:"نقداً"}],"item-value":"value","item-title":"title",label:"طريقة الدفع",clearable:"",placeholder:"اختر طريقة"},null,8,["modelValue"])]),m("div",null,[a(u,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),label:"تاريخ الدفع من",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"])]),m("div",null,[a(u,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),label:"تاريخ الدفع إلى",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"])]),a(X),a($,{"prepend-icon":"tabler-rotate-clockwise",onClick:me,variant:"outlined"},{default:o(()=>e[19]||(e[19]=[i(" إعادة تعيين ")])),_:1,__:[19]}),a($,{"prepend-icon":"tabler-plus",onClick:e[7]||(e[7]=t=>M.value=!0)},{default:o(()=>e[20]||(e[20]=[i(" إضافة دفع جديد ")])),_:1,__:[20]})]),_:1}),a(Ee),a(Se,{"items-per-page":d.value,"onUpdate:itemsPerPage":e[9]||(e[9]=t=>d.value=t),"model-value":U.value,"onUpdate:modelValue":e[10]||(e[10]=t=>U.value=t),page:p.value,"onUpdate:page":e[11]||(e[11]=t=>p.value=t),items:oe.value,"item-value":"id","items-length":x.value,headers:le,class:"text-no-wrap",loading:h.value,"onUpdate:options":ee},{"item.user_name":o(({item:t})=>[m("a",{onClick:ge(F=>{var C,q,H;return ke(Q).push(`/admin/users/${((q=(C=t.subscription)==null?void 0:C.user)==null?void 0:q.id)??((H=t.subscription)==null?void 0:H.user_id)}`)},["prevent"]),class:"text-primary cursor-pointer"},z(t.user_name),9,Me)]),"item.plan_name":o(({item:t})=>[i(z(t.plan_name),1)]),"item.actions":o(({item:t})=>[a(c,{onClick:F=>{var C;return ue((C=t.subscription)==null?void 0:C.id)}},{default:o(()=>[a(f,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),a(c,{onClick:F=>se(t)},{default:o(()=>[a(f,{icon:"tabler-pencil"})]),_:2},1032,["onClick"]),a(c,{onClick:F=>te(t.id)},{default:o(()=>[a(f,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(A,{page:p.value,"onUpdate:page":e[8]||(e[8]=t=>p.value=t),"items-per-page":d.value,"total-items":x.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Pe,{"is-drawer-open":M.value,"onUpdate:isDrawerOpen":e[12]||(e[12]=t=>M.value=t),onPlanData:ne},null,8,["is-drawer-open"]),a(Ce,{"is-drawer-open":R.value,"onUpdate:isDrawerOpen":e[13]||(e[13]=t=>R.value=t),"plan-data":j.value,onPlanData:re},null,8,["is-drawer-open","plan-data"]),a(Ue,{modelValue:B.value,"onUpdate:modelValue":e[15]||(e[15]=t=>B.value=t),color:E.value,location:"top end",timeout:"5000"},{prepend:o(()=>[E.value==="success"?(G(),J(f,{key:0,icon:"tabler-check"})):E.value==="error"?(G(),J(f,{key:1,icon:"tabler-alert-circle"})):xe("",!0)]),actions:o(()=>[a($,{icon:"",variant:"text",color:"white",onClick:e[14]||(e[14]=t=>B.value=!1)},{default:o(()=>[a(f,{icon:"tabler-x"})]),_:1})]),default:o(()=>[i(" "+z(Z.value)+" ",1)]),_:1},8,["modelValue","color"]),a(Be,{modelValue:k.value,"onUpdate:modelValue":e[17]||(e[17]=t=>k.value=t),"max-width":"500px"},{default:o(()=>[a(K,null,{default:o(()=>[a(L,{class:"text-h6"},{default:o(()=>e[21]||(e[21]=[i("تأكيد الحذف")])),_:1,__:[21]}),a(W,null,{default:o(()=>e[22]||(e[22]=[i("هل أنت متأكد أنك تريد حذف هذا الدفع؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[22]}),a(Te,{class:"px-6 pb-4"},{default:o(()=>[a(X),a($,{color:"error",variant:"flat",onClick:e[16]||(e[16]=t=>k.value=!1)},{default:o(()=>e[23]||(e[23]=[i("إلغاء")])),_:1,__:[23]}),a($,{color:"success",variant:"flat",onClick:ae},{default:o(()=>e[24]||(e[24]=[i("موافق")])),_:1,__:[24]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ht=$e(Re,[["__scopeId","data-v-dceedde0"]]);export{ht as default};
