import{_ as _e}from"./TablePagination-B8d9hxqa.js";import{_ as ge}from"./AppDateTimePicker-Bfo9Kk5q.js";import{_ as Ve}from"./AppTextField-D7_sgzpA.js";import{_ as ye}from"./AppSelect-Be37VUwQ.js";import{r as s,E as be,w as j,V as xe,c as q,b as a,e as o,i as ke,a as H,o as I,s as i,d as u,ae as y,t as p,Z as k,f as O,k as we}from"./main-DFArCsHY.js";import{$ as B}from"./api-XzAV96D5.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as J,a as Ce,b as K,d as De}from"./VCard-DxEjI5j5.js";import{V as Ue}from"./VSnackbar-DEKLRHEo.js";import{V as Te}from"./VDialog-Comn7H6S.js";import{V as Y}from"./VCardText-DPCtp8hQ.js";import{V as W}from"./VSpacer-Ix0ciMj8.js";import{V as X}from"./VDivider-r3A3xjrj.js";import{V as Ae}from"./VTextarea-h15yfphu.js";import{V as $e}from"./VDataTableServer-aed43sCK.js";import{V as Ie}from"./VAvatar-CR6ulyn0.js";import{V as Be}from"./VImg-u4PCXAxX.js";import{V as Pe}from"./VCheckbox-CM5ODX7n.js";import"./VPagination-uZ1sW5JS.js";import"./VField-Df9Z3FAQ.js";import"./form-Dca2QsTl.js";import"./easing-Bybner-F.js";import"./VInput-CTSxe1am.js";import"./VTextField-umeveIvf.js";/* empty css                   */import"./VCounter-COEwzdbN.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-DMNaQ-fx.js";import"./VList-CePb2jwz.js";import"./ssrBoot-BYwRCcks.js";import"./dialog-transition-DJ8svTM-.js";import"./VMenu-CGIlYQhN.js";import"./VOverlay-DAJAZdL3.js";import"./delay-DmoI4jxp.js";import"./lazy-Cxg2GrII.js";import"./scopeId-C1yITn5F.js";import"./VCheckboxBtn-CTXDyT5c.js";import"./VSelectionControl-CPzmbhb-.js";import"./VChip-D7ojS-xb.js";import"./VSlideGroup-D22aarxl.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VDataTable-_pKsa3bT.js";import"./VTable-iLxlgEJ3.js";import"./filter-B-rpF6id.js";const Ee={class:"me-3 d-flex gap-3"},Me={style:{"min-width":"200px"}},Re={style:{"min-width":"200px"}},Se={style:{"min-width":"200px"}},Ne={style:{"min-width":"200px"}},ze={style:{"min-width":"200px"}},Fe={class:"d-flex flex-column gap-3"},Le={class:"d-flex gap-2 align-center"},Ge={class:"text-sm text-muted ms-3"},Oe={class:"d-flex align-center gap-x-4"},Ye={key:1},Qe={class:"d-flex flex-column"},Ze={class:"text-base"},je={class:"text-sm"},qe={class:"d-flex align-center gap-x-2"},He={class:"text-capitalize text-high-emphasis text-body-1"},Je={__name:"add",setup(Ke){const ee=ke(),w=s(""),h=s(null),C=s(null),D=s(null),U=s(null),P=s([]),te=async()=>{var l;try{const e=await B("/plans",{method:"GET",params:{per_page:200}});e&&e.status==="success"?P.value=Array.isArray(e.data)?e.data:((l=e.data)==null?void 0:l.data)??e.data??[]:P.value=[]}catch(e){console.error("Error fetching plans",e),P.value=[]}},_=s(10),g=s(1),z=s(),F=s(),d=s([]),ae=l=>{var e,r,v,f;z.value=(r=(e=l.sortBy)==null?void 0:e[0])==null?void 0:r.key,F.value=(f=(v=l.sortBy)==null?void 0:v[0])==null?void 0:f.order},E=s(!1),Q=s(""),M=s("success"),c=(l,e="success")=>{Q.value=l,M.value=e,E.value=!0},T=s(!1),R=s(null),le=l=>{R.value=l,T.value=!0},oe=async()=>{R.value&&(await pe(R.value),T.value=!1,R.value=null)},se=l=>{if(!l)return"غير محدد";const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),v=new Date(l),$=new Date(v.getFullYear(),v.getMonth(),v.getDate()).getTime()-r.getTime(),x=Math.ceil($/(1e3*60*60*24));return x>0?`متبقي ${x} يوم`:x===0?"ينتهي اليوم":"منتهية"},b=s(""),A=s(!1),S=s([]),re=async()=>{var l;if(S.value.length&&S.value.length===m.value)return S.value;try{A.value=!0;const e=m.value&&m.value>0?m.value:1e3,r=await B("/users",{method:"GET",params:{per_page:e,page:1}});if(r&&r.status==="success"){const f=(Array.isArray(r.data)?r.data:((l=r.data)==null?void 0:l.data)??r.data??[]).map($=>$.id).filter(Boolean);return S.value=f,A.value=!1,f}else return A.value=!1,[]}catch(e){return console.error("Error fetching all user ids",e),A.value=!1,[]}},ne=async()=>{if(m.value<=V.value.length){d.value=V.value.map(e=>e.id),c(`تم تحديد ${d.value.length} مستخدم.`,"success");return}const l=await re();l.length?(d.value=l,c(`تم تحديد جميع المستخدمين (${l.length}).`,"success")):(d.value=V.value.map(e=>e.id),c("لم أتمكن من جلب كل المستخدمين من السيرفر — تم تحديد المستخدمين في الصفحة الحالية فقط.","warning"))},ie=()=>{d.value=[],c("تم إلغاء تحديد الكل","success")},ue=async()=>{const l=d.value;if(!l||l.length===0){c("برجاء اختيار مستخدمين أولاً","error");return}if(!b.value||!b.value.trim()){c("برجاء كتابة نص الإشعار","error");return}try{await B("/notifications",{method:"POST",body:{user_ids:l,message:b.value.trim()}}),c("تم إرسال الإشعار بنجاح","success"),b.value=""}catch(e){console.error("Error sending notification",e),c("حدث خطأ أثناء إرسال الإشعار","error")}},de=[{title:"",key:"select",sortable:!1},{title:"المستخدم",key:"user"},{title:"النوع",key:"role"},{title:"عدد الفولدرات",key:"folders",sortable:!1},{title:"عدد الكلمات",key:"words",sortable:!1},{title:"باقة الاشتراك",key:"plan"},{title:"بداية الاشتراك",key:"start_at"},{title:"نهاية الاشتراك",key:"expires_at"},{title:"الوقت المتبقي",key:"remain"},{title:"العمليات",key:"actions",sortable:!1}],V=s([]),m=s(0),L=s(!0),N=async()=>{var l;L.value=!0;try{const e={role:h.value||void 0,search:w.value||void 0,plan_id:C.value||void 0,start_date:D.value||void 0,end_date:U.value||void 0,per_page:_.value,page:g.value,sort_by:z.value||void 0,sort_order:F.value||void 0},r=await B("/users",{method:"GET",params:e});r&&r.status==="success"?(V.value=r.data,m.value=((l=r.meta)==null?void 0:l.total)||(Array.isArray(r.data)?r.data.length:0)):(V.value=[],m.value=0)}catch(e){console.error("Error fetching users",e),V.value=[],m.value=0}finally{L.value=!1}},ce=()=>{w.value="",h.value=null,C.value=null,D.value=null,U.value=null};be(async()=>{await te(),N()}),j([w,h,C,D,U,_,z,F],()=>{g.value=1,N()}),j(g,()=>{N()});const me=xe(()=>V.value),G=l=>{const e=l==null?void 0:l.toLowerCase();return e==="subscriber"?{color:"success",icon:"tabler-user"}:e==="author"?{color:"error",icon:"tabler-device-desktop"}:e==="maintainer"?{color:"info",icon:"tabler-chart-pie"}:e==="editor"?{color:"warning",icon:"tabler-edit"}:e==="admin"?{color:"primary",icon:"tabler-crown"}:{color:"primary",icon:"tabler-user"}};s(null);const pe=async l=>{try{await B(`/users/delete/${l}`,{method:"POST"}),c("تم الحذف بنجاح","success"),N()}catch{c("حدث خطأ أثناء الحذف","error")}},ve=l=>{ee.push({name:"admin-users-id",params:{id:l}})};return(l,e)=>{const r=ye,v=Ve,f=ge,$=H("RouterLink"),x=H("IconBtn"),fe=_e;return I(),q("section",null,[a(J,{class:"mb-6"},{default:o(()=>[a(Ce,{class:"pb-4"},{default:o(()=>[a(K,null,{default:o(()=>e[16]||(e[16]=[i("ارسال اشعار")])),_:1,__:[16]})]),_:1}),a(Y,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[u("div",Ee,[a(r,{label:"عرض","model-value":_.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=parseInt(t,10))},null,8,["model-value","items"])]),u("div",Me,[a(v,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),placeholder:"بحث بالاسم أو الايميل",label:"بحث"},null,8,["modelValue"])]),u("div",Re,[a(r,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),items:[{value:"user",title:"مستخدم"},{value:"admin",title:"مدير"}],label:"النوع",clearable:""},null,8,["modelValue"])]),u("div",Se,[a(r,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),items:P.value,"item-value":"id","item-title":"name",label:"الباقة",clearable:"",placeholder:"اختر باقة"},null,8,["modelValue","items"])]),u("div",Ne,[a(f,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),label:"تاريخ البداية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),u("div",ze,[a(f,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=t=>U.value=t),label:"تاريخ النهاية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),a(W),a(y,{"prepend-icon":"tabler-rotate-clockwise",variant:"outlined",onClick:ce},{default:o(()=>e[17]||(e[17]=[i(" إعادة تعيين ")])),_:1,__:[17]})]),_:1}),a(X),a(Y,{class:"pb-2"},{default:o(()=>[u("div",Fe,[a(Ae,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),label:"نص الإشعار",rows:"3",placeholder:"اكتب الإشعار هنا"},null,8,["modelValue"]),u("div",Le,[a(y,{color:"primary",loading:!1,onClick:ue},{default:o(()=>e[18]||(e[18]=[i(" إرسال الإشعار ")])),_:1,__:[18]}),a(y,{color:"success",variant:"outlined",loading:A.value,onClick:ne},{default:o(()=>e[19]||(e[19]=[i(" تحديد الكل ")])),_:1,__:[19]},8,["loading"]),a(y,{color:"error",variant:"outlined",onClick:ie},{default:o(()=>e[20]||(e[20]=[i(" إلغاء التحديد ")])),_:1,__:[20]}),u("div",Ge,p(d.value.length)+" مختار ",1)])])]),_:1}),a(X),a($e,{"items-per-page":_.value,"onUpdate:itemsPerPage":e[9]||(e[9]=t=>_.value=t),"model-value":d.value,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value=t),page:g.value,"onUpdate:page":e[11]||(e[11]=t=>g.value=t),items:me.value,"item-value":"id","items-length":m.value,headers:de,class:"text-no-wrap",loading:L.value,"onUpdate:options":ae},{"item.select":o(({item:t})=>[a(Pe,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=n=>d.value=n),value:t.id,density:"compact","hide-details":""},null,8,["modelValue","value"])]),"item.user":o(({item:t})=>[u("div",Oe,[a(Ie,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:G(t.role).color},{default:o(()=>{var n;return[t.avatar?(I(),O(Be,{key:0,src:t.avatar},null,8,["src"])):(I(),q("span",Ye,p((n=t.name)==null?void 0:n.charAt(0).toUpperCase()),1))]}),_:2},1032,["variant","color"]),u("div",Qe,[u("h6",Ze,[a($,{to:{name:"apps-user-view-id",params:{id:t.id}},class:"font-weight-medium text-link"},{default:o(()=>[i(p(t.name),1)]),_:2},1032,["to"])]),u("div",je,p(t.email),1)])])]),"item.role":o(({item:t})=>[u("div",qe,[a(k,{size:22,icon:G(t.role).icon,color:G(t.role).color},null,8,["icon","color"]),u("div",He,p(t.role=="user"?"عميل":"ادمن"),1)])]),"item.plan":o(({item:t})=>{var n,Z;return[i(p(((Z=(n=t.subscription)==null?void 0:n.plan)==null?void 0:Z.name)||"غير مشترك"),1)]}),"item.start_at":o(({item:t})=>{var n;return[i(p(((n=t.subscription)==null?void 0:n.start_date)??"غير محدد"),1)]}),"item.expires_at":o(({item:t})=>{var n;return[i(p(((n=t.subscription)==null?void 0:n.end_date)??"غير محدد"),1)]}),"item.remain":o(({item:t})=>{var n;return[i(p(se((n=t.subscription)==null?void 0:n.end_date)),1)]}),"item.actions":o(({item:t})=>[a(x,{onClick:n=>le(t.id)},{default:o(()=>[a(k,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a(x,{onClick:n=>ve(t.id)},{default:o(()=>[a(k,{icon:"tabler-eye"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(fe,{page:g.value,"onUpdate:page":e[8]||(e[8]=t=>g.value=t),"items-per-page":_.value,"total-items":m.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Ue,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=t=>E.value=t),color:M.value,location:"top end",timeout:"5000"},{prepend:o(()=>[M.value==="success"?(I(),O(k,{key:0,icon:"tabler-check"})):M.value==="error"?(I(),O(k,{key:1,icon:"tabler-alert-circle"})):we("",!0)]),actions:o(()=>[a(y,{icon:"",variant:"text",color:"white",onClick:e[12]||(e[12]=t=>E.value=!1)},{default:o(()=>[a(k,{icon:"tabler-x"})]),_:1})]),default:o(()=>[i(" "+p(Q.value)+" ",1)]),_:1},8,["modelValue","color"]),a(Te,{modelValue:T.value,"onUpdate:modelValue":e[15]||(e[15]=t=>T.value=t),"max-width":"500px"},{default:o(()=>[a(J,null,{default:o(()=>[a(K,{class:"text-h6"},{default:o(()=>e[21]||(e[21]=[i(" تأكيد الحذف ")])),_:1,__:[21]}),a(Y,null,{default:o(()=>e[22]||(e[22]=[i("هل أنت متأكد أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[22]}),a(De,{class:"px-6 pb-4"},{default:o(()=>[a(W),a(y,{color:"error",variant:"flat",onClick:e[14]||(e[14]=t=>T.value=!1)},{default:o(()=>e[23]||(e[23]=[i(" إلغاء ")])),_:1,__:[23]}),a(y,{color:"success",variant:"flat",onClick:oe},{default:o(()=>e[24]||(e[24]=[i(" موافق ")])),_:1,__:[24]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ot=he(Je,[["__scopeId","data-v-45d34c61"]]);export{Ot as default};
