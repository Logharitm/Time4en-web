import{_ as ge}from"./TablePagination-DdKTX9OV.js";import{_ as _e}from"./AppDateTimePicker-Dr5P4Pgx.js";import{_ as Ve}from"./AppTextField-aZv7gLR1.js";import{_ as ye}from"./AppSelect-Dc5xzrsl.js";import{r as s,E as be,w as q,V as xe,c as H,b as a,e as o,i as ke,a as we,o as B,s as u,d as i,a5 as y,t as p,Z as w,f as Y,k as he}from"./main-BoNGmApi.js";import{$ as P}from"./api-CHPjDHzy.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as J,a as Ue,b as K,d as De}from"./VCard-CIKASufN.js";import{V as Te}from"./VSnackbar-nXt_2vgz.js";import{V as Ae}from"./VDialog-fBE2blFA.js";import{V as Q}from"./VCardText-DDkz13nn.js";import{V as W}from"./VSpacer-EjYJj1Z_.js";import{V as X}from"./VDivider-COJgEHam.js";import{V as ee}from"./VTextarea-B2fVnDlT.js";import{V as $e}from"./VDataTableServer-cQiRBdfY.js";import{V as Ie}from"./VAvatar-B4jUlWaz.js";import{V as Be}from"./VImg-C0UW1cvE.js";import{V as Pe}from"./VCheckbox-DVRJe9wS.js";import"./VPagination-g7dDgunw.js";import"./VField-CGulMkEM.js";import"./form-BOCittNv.js";import"./easing-Bybner-F.js";import"./VInput-UNY5FM3D.js";import"./VTextField-DfsZX4z1.js";/* empty css                   */import"./VCounter-BrDhg_jj.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-DvY4lhKB.js";import"./VList-dMazRKTH.js";import"./ssrBoot-CbhHCPX2.js";import"./dialog-transition-DSZfBO75.js";import"./VMenu-Ct53Bckx.js";import"./VOverlay-BEh_8h-6.js";import"./delay-VWJ3yp0p.js";import"./lazy-CCMlf-LN.js";import"./scopeId-9mEpF7-z.js";import"./VCheckboxBtn-CXq9-h6C.js";import"./VSelectionControl-BjjFP2rz.js";import"./VChip-CFWLr0Fc.js";import"./VSlideGroup-BuutOZ8P.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VDataTable-C6qSTHw6.js";import"./VTable-Bdz8hCOV.js";import"./filter-JpcQOUJD.js";const Ee={class:"me-3 d-flex gap-3"},Me={style:{"min-width":"200px"}},Se={style:{"min-width":"200px"}},Ne={style:{"min-width":"200px"}},Re={style:{"min-width":"200px"}},ze={style:{"min-width":"200px"}},Fe={class:"d-flex flex-column gap-3"},Ge={class:"d-flex gap-2 align-center"},Oe={class:"text-sm text-muted ms-3"},Le={class:"d-flex align-center gap-x-4"},Ye={key:1},Qe={class:"d-flex flex-column"},Ze={class:"text-base"},je={class:"text-sm"},qe={class:"d-flex align-center gap-x-2"},He={class:"text-capitalize text-high-emphasis text-body-1"},Je={__name:"add",setup(Ke){const te=ke(),h=s(""),C=s(null),U=s(null),D=s(null),T=s(null),E=s([]),ae=async()=>{var l;try{const e=await P("/plans",{method:"GET",params:{per_page:200}});e&&e.status==="success"?E.value=Array.isArray(e.data)?e.data:((l=e.data)==null?void 0:l.data)??e.data??[]:E.value=[]}catch(e){console.error("Error fetching plans",e),E.value=[]}},g=s(10),_=s(1),F=s(),G=s(),d=s([]),le=l=>{var e,r,v,f;F.value=(r=(e=l.sortBy)==null?void 0:e[0])==null?void 0:r.key,G.value=(f=(v=l.sortBy)==null?void 0:v[0])==null?void 0:f.order},M=s(!1),Z=s(""),S=s("success"),c=(l,e="success")=>{Z.value=l,S.value=e,M.value=!0},A=s(!1),N=s(null),oe=l=>{N.value=l,A.value=!0},se=async()=>{N.value&&(await ve(N.value),A.value=!1,N.value=null)},re=l=>{if(!l)return"غير محدد";const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),v=new Date(l),k=new Date(v.getFullYear(),v.getMonth(),v.getDate()).getTime()-r.getTime(),I=Math.ceil(k/(1e3*60*60*24));return I>0?`متبقي ${I} يوم`:I===0?"ينتهي اليوم":"منتهية"},b=s(""),x=s(""),$=s(!1),R=s([]),ne=async()=>{var l;if(R.value.length&&R.value.length===m.value)return R.value;try{$.value=!0;const e=m.value&&m.value>0?m.value:1e3,r=await P("/users",{method:"GET",params:{per_page:e,page:1}});if(r&&r.status==="success"){const f=(Array.isArray(r.data)?r.data:((l=r.data)==null?void 0:l.data)??r.data??[]).map(k=>k.id).filter(Boolean);return R.value=f,$.value=!1,f}else return $.value=!1,[]}catch(e){return console.error("Error fetching all user ids",e),$.value=!1,[]}},ie=async()=>{if(m.value<=V.value.length){d.value=V.value.map(e=>e.id),c(`تم تحديد ${d.value.length} مستخدم.`,"success");return}const l=await ne();l.length?(d.value=l,c(`تم تحديد جميع المستخدمين (${l.length}).`,"success")):(d.value=V.value.map(e=>e.id),c("لم أتمكن من جلب كل المستخدمين من السيرفر — تم تحديد المستخدمين في الصفحة الحالية فقط.","warning"))},ue=()=>{d.value=[],c("تم إلغاء تحديد الكل","success")},de=async()=>{const l=d.value;if(!l||l.length===0){c("برجاء اختيار مستخدمين أولاً","error");return}if(!b.value||!b.value.trim()){c("برجاء كتابة نص الإشعار","error");return}if(!x.value||!x.value.trim()){c("برجاء كتابة نص الإشعار","error");return}try{await P("/notifications",{method:"POST",body:{user_ids:l,message:b.value.trim(),message_en:x.value.trim()}}),c("تم إرسال الإشعار بنجاح","success"),b.value=x.value=""}catch(e){console.error("Error sending notification",e),c("حدث خطأ أثناء إرسال الإشعار","error")}},ce=[{title:"",key:"select",sortable:!1},{title:"المستخدم",key:"user"},{title:"النوع",key:"role"},{title:"عدد الفولدرات",key:"folders",sortable:!1},{title:"عدد الكلمات",key:"words",sortable:!1},{title:"باقة الاشتراك",key:"plan"},{title:"بداية الاشتراك",key:"start_at"},{title:"نهاية الاشتراك",key:"expires_at"},{title:"الوقت المتبقي",key:"remain"}],V=s([]),m=s(0),O=s(!0),z=async()=>{var l;O.value=!0;try{const e={role:C.value||void 0,search:h.value||void 0,plan_id:U.value||void 0,start_date:D.value||void 0,end_date:T.value||void 0,per_page:g.value,page:_.value,sort_by:F.value||void 0,sort_order:G.value||void 0},r=await P("/users",{method:"GET",params:e});r&&r.status==="success"?(V.value=r.data,m.value=((l=r.meta)==null?void 0:l.total)||(Array.isArray(r.data)?r.data.length:0)):(V.value=[],m.value=0)}catch(e){console.error("Error fetching users",e),V.value=[],m.value=0}finally{O.value=!1}},me=()=>{h.value="",C.value=null,U.value=null,D.value=null,T.value=null};be(async()=>{await ae(),z()}),q([h,C,U,D,T,g,F,G],()=>{_.value=1,z()}),q(_,()=>{z()});const pe=xe(()=>V.value),L=l=>{const e=l==null?void 0:l.toLowerCase();return e==="subscriber"?{color:"success",icon:"tabler-user"}:e==="author"?{color:"error",icon:"tabler-device-desktop"}:e==="maintainer"?{color:"info",icon:"tabler-chart-pie"}:e==="editor"?{color:"warning",icon:"tabler-edit"}:e==="admin"?{color:"primary",icon:"tabler-crown"}:{color:"primary",icon:"tabler-user"}};s(null);const ve=async l=>{try{await P(`/users/delete/${l}`,{method:"POST"}),c("تم الحذف بنجاح","success"),z()}catch{c("حدث خطأ أثناء الحذف","error")}},fe=l=>{te.push({name:"admin-users-id",params:{id:l}})};return(l,e)=>{const r=ye,v=Ve,f=_e,k=we("IconBtn"),I=ge;return B(),H("section",null,[a(J,{class:"mb-6"},{default:o(()=>[a(Ue,{class:"pb-4"},{default:o(()=>[a(K,null,{default:o(()=>e[17]||(e[17]=[u("ارسال اشعار")])),_:1,__:[17]})]),_:1}),a(Q,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[i("div",Ee,[a(r,{label:"عرض","model-value":g.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=parseInt(t,10))},null,8,["model-value","items"])]),i("div",Me,[a(v,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"بحث بالاسم أو الايميل",label:"بحث"},null,8,["modelValue"])]),i("div",Se,[a(r,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),items:[{value:"user",title:"مستخدم"},{value:"admin",title:"مدير"}],label:"النوع",clearable:""},null,8,["modelValue"])]),i("div",Ne,[a(r,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=t=>U.value=t),items:E.value,"item-value":"id","item-title":"name",label:"الباقة",clearable:"",placeholder:"اختر باقة"},null,8,["modelValue","items"])]),i("div",Re,[a(f,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),label:"تاريخ البداية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),i("div",ze,[a(f,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=t=>T.value=t),label:"تاريخ النهاية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),a(W),a(y,{"prepend-icon":"tabler-rotate-clockwise",variant:"outlined",onClick:me},{default:o(()=>e[18]||(e[18]=[u(" إعادة تعيين ")])),_:1,__:[18]})]),_:1}),a(X),a(Q,{class:"pb-2"},{default:o(()=>[i("div",Fe,[a(ee,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),label:"نص الإشعار",rows:"3",placeholder:"اكتب الإشعار هنا"},null,8,["modelValue"]),a(ee,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=t=>x.value=t),label:"نص الاشعار بالانجليزية",rows:"3",placeholder:"اكتب الإشعار بالانجليزية هنا"},null,8,["modelValue"]),i("div",Ge,[a(y,{color:"primary",loading:!1,onClick:de},{default:o(()=>e[19]||(e[19]=[u(" إرسال الإشعار ")])),_:1,__:[19]}),a(y,{color:"success",variant:"outlined",loading:$.value,onClick:ie},{default:o(()=>e[20]||(e[20]=[u(" تحديد الكل ")])),_:1,__:[20]},8,["loading"]),a(y,{color:"error",variant:"outlined",onClick:ue},{default:o(()=>e[21]||(e[21]=[u(" إلغاء التحديد ")])),_:1,__:[21]}),i("div",Oe,p(d.value.length)+" مختار ",1)])])]),_:1}),a(X),a($e,{"items-per-page":g.value,"onUpdate:itemsPerPage":e[10]||(e[10]=t=>g.value=t),"model-value":d.value,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value=t),page:_.value,"onUpdate:page":e[12]||(e[12]=t=>_.value=t),items:pe.value,"item-value":"id","items-length":m.value,headers:ce,class:"text-no-wrap",loading:O.value,"onUpdate:options":le},{"item.select":o(({item:t})=>[a(Pe,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=n=>d.value=n),value:t.id,density:"compact","hide-details":""},null,8,["modelValue","value"])]),"item.user":o(({item:t})=>[i("div",Le,[a(Ie,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:L(t.role).color},{default:o(()=>{var n;return[t.avatar?(B(),Y(Be,{key:0,src:t.avatar},null,8,["src"])):(B(),H("span",Ye,p((n=t.name)==null?void 0:n.charAt(0).toUpperCase()),1))]}),_:2},1032,["variant","color"]),i("div",Qe,[i("h6",Ze,p(t.name),1),i("div",je,p(t.email),1)])])]),"item.role":o(({item:t})=>[i("div",qe,[a(w,{size:22,icon:L(t.role).icon,color:L(t.role).color},null,8,["icon","color"]),i("div",He,p(t.role=="user"?"عميل":"ادمن"),1)])]),"item.plan":o(({item:t})=>{var n,j;return[u(p(((j=(n=t.subscription)==null?void 0:n.plan)==null?void 0:j.name)||"غير مشترك"),1)]}),"item.start_at":o(({item:t})=>{var n;return[u(p(((n=t.subscription)==null?void 0:n.start_date)??"غير محدد"),1)]}),"item.expires_at":o(({item:t})=>{var n;return[u(p(((n=t.subscription)==null?void 0:n.end_date)??"غير محدد"),1)]}),"item.remain":o(({item:t})=>{var n;return[u(p(re((n=t.subscription)==null?void 0:n.end_date)),1)]}),"item.actions":o(({item:t})=>[a(k,{onClick:n=>oe(t.id)},{default:o(()=>[a(w,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a(k,{onClick:n=>fe(t.id)},{default:o(()=>[a(w,{icon:"tabler-eye"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(I,{page:_.value,"onUpdate:page":e[9]||(e[9]=t=>_.value=t),"items-per-page":g.value,"total-items":m.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Te,{modelValue:M.value,"onUpdate:modelValue":e[14]||(e[14]=t=>M.value=t),color:S.value,location:"top end",timeout:"5000"},{prepend:o(()=>[S.value==="success"?(B(),Y(w,{key:0,icon:"tabler-check"})):S.value==="error"?(B(),Y(w,{key:1,icon:"tabler-alert-circle"})):he("",!0)]),actions:o(()=>[a(y,{icon:"",variant:"text",color:"white",onClick:e[13]||(e[13]=t=>M.value=!1)},{default:o(()=>[a(w,{icon:"tabler-x"})]),_:1})]),default:o(()=>[u(" "+p(Z.value)+" ",1)]),_:1},8,["modelValue","color"]),a(Ae,{modelValue:A.value,"onUpdate:modelValue":e[16]||(e[16]=t=>A.value=t),"max-width":"500px"},{default:o(()=>[a(J,null,{default:o(()=>[a(K,{class:"text-h6"},{default:o(()=>e[22]||(e[22]=[u(" تأكيد الحذف ")])),_:1,__:[22]}),a(Q,null,{default:o(()=>e[23]||(e[23]=[u("هل أنت متأكد أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[23]}),a(De,{class:"px-6 pb-4"},{default:o(()=>[a(W),a(y,{color:"error",variant:"flat",onClick:e[15]||(e[15]=t=>A.value=!1)},{default:o(()=>e[24]||(e[24]=[u(" إلغاء ")])),_:1,__:[24]}),a(y,{color:"success",variant:"flat",onClick:se},{default:o(()=>e[25]||(e[25]=[u(" موافق ")])),_:1,__:[25]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Lt=Ce(Je,[["__scopeId","data-v-1effcccf"]]);export{Lt as default};
