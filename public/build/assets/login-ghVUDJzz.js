import{r as C,e as B}from"./validators-DpYrMFzk.js";import{r as m,u as N,i as M,a2 as P,w as U,a as E,c as G,o as L,b as s,e as o,d as i,l as a,G as b,t as p,s as h,ak as O,f as z,k as H,$ as J,a5 as K,F as Q,a3 as w,ax as W}from"./main-DSzMYLzp.js";import{_ as X}from"./AppTextField-BWx9dSw2.js";import{u as R}from"./useGenerateImageVariant-DhZiHa9W.js";import{a as Y,b as j,c as Z}from"./auth-v2-login-illustration-dark-C63R5FOO.js";import{m as ee,a as ae}from"./misc-mask-light-Bi5cOsdU.js";import{V as se}from"./VNodeRenderer-C4t7i_ij.js";import{$ as te}from"./api-DfH6QBqv.js";import{a as f,V as q}from"./VRow-CXKAFC9P.js";import{V as oe}from"./VImg-DNHHYH1j.js";import{V as re}from"./VCard-DuhDOrWR.js";import{V as D}from"./VCardText-CYf2INNP.js";import{V as le}from"./VForm-CPPstvq0.js";import{V as ie}from"./VAlert-B-jmREU_.js";import{V as ne}from"./VCheckbox-DM0fJ_U-.js";import"./helpers-DK5QwNv0.js";import"./form-B1tFRS7d.js";import"./VTextField-CziLb0ab.js";/* empty css                   */import"./VCounter-CgP2sO8g.js";import"./VField-D6MI6Ow5.js";import"./easing-Bybner-F.js";import"./VInput-CPAsoCij.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-CS_wgqDD.js";import"./VCheckboxBtn-BPHfXDUK.js";import"./VSelectionControl-l_Y0JvA-.js";const ue={class:"auth-logo d-flex align-center gap-x-3"},de={class:"auth-title"},me={class:"position-relative bg-background w-100 me-0"},pe={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ce=["src"],fe={class:"text-h4 mb-1"},ge={class:"text-capitalize"},ve={class:"text-error"},Ve={class:"d-flex align-center flex-wrap justify-space-between my-6"},he={class:"d-inline-block"},Qe={__name:"login",setup(_e){const F=R(j,Z,j,Y,!0),I=R(ae,ee),g=m(!1),k=N(),y=M(),S=P(),n=m({email:void 0,password:void 0}),l=m(""),c=m(!1),x=m(),u=m({email:"",password:""}),_=m(!1),$=async()=>{var r;n.value={email:void 0,password:void 0},l.value="",c.value=!0;try{const e=await te("/login",{method:"POST",body:{email:u.value.email,password:u.value.password}}),t=(e==null?void 0:e.data)??e;if(!t.accessToken){l.value="Login failed. No access token received.";return}const v=t.accessToken,d=t.userData??{name:t.name,role:t.role,avatar:t.avatar??null,email:u.value.email};let V=[];d.role==="admin"?V=[{action:"manage",subject:"all"}]:V=[{action:"read",subject:"Home"}],w("accessToken").value=v,w("userData").value=d,w("userAbilityRules").value=V,S.update(V);const T=k.query.to?String(k.query.to):"/";y.currentRoute.value.fullPath!==T&&await W(()=>y.replace(T))}catch(e){if(console.error("Login error:",e),(r=e.response)!=null&&r._data){const t=e.response._data;t.message&&(l.value=t.message),t.errors&&Object.keys(t.errors).length>0&&(n.value={...n.value,...t.errors}),t.status==="error"&&t.message&&(l.value=t.message)}else e.message?l.value=e.message:l.value="Something went wrong, please try again."}finally{c.value=!1}},A=()=>{var r;n.value={email:void 0,password:void 0},l.value="",(r=x.value)==null||r.validate().then(({valid:e})=>{e&&$()})};return U([()=>u.value.email,()=>u.value.password],()=>{l.value&&(l.value=""),(n.value.email||n.value.password)&&(n.value={email:void 0,password:void 0})}),(r,e)=>{const t=E("RouterLink"),v=X;return L(),G(Q,null,[s(t,{to:"/"},{default:o(()=>[i("div",ue,[s(a(se),{nodes:a(b).app.logo},null,8,["nodes"]),i("h1",de,p(a(b).app.title),1)])]),_:1}),s(q,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[s(f,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[i("div",me,[i("div",pe,[s(oe,{"max-width":"613",src:a(F),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),i("img",{class:"auth-footer-mask",src:a(I),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ce)])]),_:1}),s(f,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[s(re,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:o(()=>[s(D,null,{default:o(()=>[i("h4",fe,[e[4]||(e[4]=h(" مرحبا بك في ")),i("span",ge,p(a(b).app.title),1)])]),_:1}),s(D,null,{default:o(()=>[s(a(le),{ref_key:"refVForm",ref:x,onSubmit:O(A,["prevent"])},{default:o(()=>[s(q,null,{default:o(()=>[s(f,{cols:"12"},{default:o(()=>[s(v,{modelValue:a(u).email,"onUpdate:modelValue":e[0]||(e[0]=d=>a(u).email=d),label:"البريد الالكتروني",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in r?r.requiredValidator:a(C),"emailValidator"in r?r.emailValidator:a(B)],"error-messages":a(n).email},null,8,["modelValue","rules","error-messages"])]),_:1}),s(f,{cols:"12"},{default:o(()=>[s(v,{modelValue:a(u).password,"onUpdate:modelValue":e[1]||(e[1]=d=>a(u).password=d),label:"كلمة المرور",placeholder:"············",rules:["requiredValidator"in r?r.requiredValidator:a(C)],type:a(g)?"text":"password",autocomplete:"password","error-messages":a(n).password,"append-inner-icon":a(g)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=d=>g.value=!a(g))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a(l)?(L(),z(ie,{key:0,color:"error",variant:"tonal",class:"mt-4"},{default:o(()=>[i("span",ve,p(a(l)),1)]),_:1})):H("",!0),i("div",Ve,[s(ne,{modelValue:a(_),"onUpdate:modelValue":e[3]||(e[3]=d=>J(_)?_.value=d:null),label:"تذكرني"},null,8,["modelValue"]),s(t,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:o(()=>e[5]||(e[5]=[h(" هل نسيت كلمة المرور ؟ ")])),_:1,__:[5]})]),s(K,{block:"",type:"submit",loading:a(c),disabled:a(c)},{default:o(()=>[h(p(a(c)?"جاري تسجيل الدخول...":"تسجيل الدخول"),1)]),_:1},8,["loading","disabled"])]),_:1}),s(f,{cols:"12",class:"text-center text-base"},{default:o(()=>[i("span",he,p(r.$t("dont have an account")),1),s(t,{class:"text-primary ms-1 d-inline-block",to:{name:"register"}},{default:o(()=>[h(p(r.$t("Sign up")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Qe as default};
