import{r as q}from"./validators-DpYrMFzk.js";import{r as t,E as L,w as x,f as b,e as r,o as d,b as o,l as k,ak as j,k as E,d as B,c as F,a5 as v,s as g,Z as z,t as H,ax as P}from"./main-Buooeazs.js";import{_ as W}from"./AppTextField-OypOW1RS.js";import{_ as Z}from"./AppSelect-DbyXVuoM.js";import{_ as J}from"./AppDrawerHeaderSection-CSYdWDeO.js";import{C as K}from"./vue3-perfect-scrollbar-DqIZH1Uk.js";import{$ as N}from"./api-uKQMEw1Y.js";import{V as Q}from"./VNavigationDrawer-exJElk6P.js";import{V as X}from"./VDivider-DRV0Ilys.js";import{V as Y}from"./VCard-BTbWDGHM.js";import{V as ee}from"./VCardText-oSvKZv6T.js";import{V as ae}from"./VForm-CldupZH8.js";import{V as oe,a as V}from"./VRow-BcoryuSp.js";import"./helpers-DK5QwNv0.js";import"./form-DUZPa8df.js";import"./VTextField-D1ul6krf.js";/* empty css                   */import"./VCounter-BXXntpG3.js";import"./VImg--AoPooaC.js";import"./VField-DppAX2b5.js";import"./easing-Bybner-F.js";import"./VInput-CKL19ZnS.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-DSRVmLwP.js";import"./VList-u2nGPrJe.js";import"./ssrBoot-DFTTPjDv.js";import"./VAvatar-CkASEzQQ.js";import"./dialog-transition-CuDUH75R.js";import"./VMenu-BAhWsY9T.js";import"./VOverlay-UhAw-ZqM.js";import"./delay-DF-w_YHW.js";import"./lazy-kxOnTNRp.js";import"./scopeId-BeSVlV_o.js";import"./VCheckboxBtn-Dhyzwr3g.js";import"./VSelectionControl-BMw0dUQ3.js";import"./VChip-l_PbC1tA.js";import"./VSlideGroup-wwX-W2zN.js";import"./VSpacer-DB0mSR9j.js";/* empty css              */import"./index-CvOPxmL5.js";const re={class:"d-flex gap-2 align-center"},le={key:2,class:"d-flex gap-2 align-center"},te=["src"],ie={key:3,class:"text-muted small"},se={key:0,class:"text-danger small mt-1"},Ze={__name:"AddWordDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},folderId:{type:Number,default:null}},emits:["update:isDrawerOpen","word-data"],setup(O,{emit:T}){const u=O,D=T,R=t(!1),_=t(),$=t(null),s=t(u.folderId),w=t(""),y=t(""),n=t(null),f=t(null),c=t(!1);let m=null,C=[];const S=t([]),p=t([]);L(async()=>{try{const a=await N("/users?role=user",{method:"GET"});S.value=a.data||[]}catch(a){console.error("Error fetching users",a)}}),x(()=>u.folderId,a=>{s.value=a}),x($,async a=>{if(a)try{const e=await N(`/folders?user_id=${a}`,{method:"GET"});p.value=e.data||[],s.value=null}catch(e){console.error("Error fetching folders",e),p.value=[],s.value=null}else p.value=[],s.value=null});const A=async()=>{f.value=null;try{const a=await navigator.mediaDevices.getUserMedia({audio:!0});m=new MediaRecorder(a),C=[],m.ondataavailable=e=>{e.data.size>0&&C.push(e.data)},m.onstop=()=>{const e=new Blob(C,{type:"audio/webm"}),i=new File([e],"recorded_audio.webm",{type:"audio/webm"});n.value=i},m.start(),c.value=!0}catch(a){f.value="حدث خطأ أثناء محاولة الوصول إلى الميكروفون",console.error("Error accessing microphone",a)}},M=()=>{m&&c.value&&(m.stop(),c.value=!1)},I=()=>{D("update:isDrawerOpen",!1),P(()=>{var a,e;(a=_.value)==null||a.reset(),(e=_.value)==null||e.resetValidation(),u.folderId||(s.value=null),w.value="",y.value="",n.value=null,f.value=null,u.folderId||(p.value=[])})},h=()=>{var a;(a=_.value)==null||a.validate().then(({valid:e})=>{if(e){const i=new FormData;i.append("folder_id",s.value),i.append("word",w.value),i.append("translation",y.value),n.value&&i.append("audio_file",n.value),D("word-data",i),I()}})};return(a,e)=>{const i=J,G=Z,U=W;return d(),b(Q,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":u.isDrawerOpen,"onUpdate:modelValue":e[5]||(e[5]=l=>D("update:isDrawerOpen",l))},{default:r(()=>[o(i,{title:"إضافة كلمة جديدة",onCancel:I}),o(X),o(k(K),{options:{wheelPropagation:!1}},{default:r(()=>[o(Y,{flat:""},{default:r(()=>[o(ee,null,{default:r(()=>[o(ae,{ref_key:"refForm",ref:_,modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=l=>R.value=l),onSubmit:j(h,["prevent"])},{default:r(()=>[o(oe,null,{default:r(()=>[!u.folderId&&p.value.length?(d(),b(V,{key:0,cols:"12"},{default:r(()=>[o(G,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),items:p.value.map(l=>({value:l.id,title:l.name})),label:"المجلد",rules:["requiredValidator"in a?a.requiredValidator:k(q)]},null,8,["modelValue","items","rules"])]),_:1})):E("",!0),o(V,{cols:"12"},{default:r(()=>[o(U,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),label:"الكلمة",rules:["requiredValidator"in a?a.requiredValidator:k(q)]},null,8,["modelValue","rules"])]),_:1}),o(V,{cols:"12"},{default:r(()=>[o(U,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=l=>y.value=l),label:"الترجمة",rules:["requiredValidator"in a?a.requiredValidator:k(q)]},null,8,["modelValue","rules"])]),_:1}),o(V,{cols:"12"},{default:r(()=>[B("div",re,[c.value?(d(),b(v,{key:1,variant:"outlined",color:"error",onClick:M},{default:r(()=>e[7]||(e[7]=[g(" إيقاف التسجيل ")])),_:1,__:[7]})):(d(),b(v,{key:0,variant:"outlined",color:"primary",onClick:A},{default:r(()=>e[6]||(e[6]=[g(" بدء التسجيل ")])),_:1,__:[6]})),n.value?(d(),F("div",le,[B("audio",{src:a.URL.createObjectURL(n.value),controls:""},null,8,te),o(v,{icon:"",variant:"text",onClick:e[3]||(e[3]=()=>{n.value=null})},{default:r(()=>[o(z,{icon:"tabler-x"})]),_:1})])):c.value?E("",!0):(d(),F("div",ie," لم يتم تسجيل صوت بعد "))]),f.value?(d(),F("div",se,H(f.value),1)):E("",!0)]),_:1}),o(V,{cols:"12"},{default:r(()=>[o(v,{type:"submit",class:"me-3"},{default:r(()=>e[8]||(e[8]=[g(" حفظ ")])),_:1,__:[8]}),o(v,{type:"reset",variant:"tonal",color:"error",onClick:I},{default:r(()=>e[9]||(e[9]=[g(" إلغاء ")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{Ze as default};
