import{r as F}from"./validators-DpYrMFzk.js";import{r as t,E as L,w as R,f as g,e as a,o as m,b as o,l as k,ak as P,k as I,d,c as U,a5 as V,s as D,Z as W,t as j,ax as z}from"./main-CG3IkRSh.js";import{_ as Z}from"./AppTextField-D7sjfavu.js";import{_ as J}from"./AppSelect-DB7--uGO.js";import{_ as K}from"./AppDrawerHeaderSection-Dt75b09S.js";import{C as Q}from"./vue3-perfect-scrollbar-ePUekIo3.js";import{$ as T}from"./api-BiIk25cj.js";import{V as X}from"./VNavigationDrawer-CVn6L_ar.js";import{V as Y}from"./VDivider-BMaMjSWQ.js";import{V as ee}from"./VCard-D708Umyd.js";import{V as le}from"./VCardText-B4D8XQzc.js";import{V as oe}from"./VForm-MveYzDB4.js";import{V as ae,a as w}from"./VRow-Chmhbr5l.js";import"./helpers-DK5QwNv0.js";import"./form-0eVxL5IN.js";import"./VTextField-KavlJx_0.js";/* empty css                   */import"./VCounter-CQYIVEat.js";import"./VImg-UsZZPD-J.js";import"./VField-BIcgXvNc.js";import"./easing-Bybner-F.js";import"./VInput-DLn4gIuB.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-B-kIFpvS.js";import"./VList-BO4xVlP5.js";import"./ssrBoot-DRV8GpEy.js";import"./VAvatar-B9hrW8uR.js";import"./dialog-transition-D938gvTE.js";import"./VMenu-DHE6rVpT.js";import"./VOverlay-BXOurBsA.js";import"./delay-BsALBX5A.js";import"./lazy-ChBzuUjv.js";import"./scopeId-CUHqbHex.js";import"./VCheckboxBtn-BTtL6pCD.js";import"./VSelectionControl-6Ze-_NSM.js";import"./VChip-CC7mVFDs.js";import"./VSlideGroup-Ba6MS0Ay.js";import"./VSpacer-h-2lS1GV.js";/* empty css              */import"./index-CvOPxmL5.js";const re={class:"d-flex flex-column gap-3"},te={class:"d-flex gap-2 align-center"},ie={key:2,class:"d-flex gap-2 align-center"},se=["src"],ne={key:3,class:"text-muted small"},ue={key:0,class:"text-danger small mt-1"},Ke={__name:"AddWordDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},folderId:{type:Number,default:null}},emits:["update:isDrawerOpen","word-data"],setup(B,{emit:O}){const p=B,C=O,q=t(!1),_=t(),S=t(null),n=t(p.folderId),y=t(""),b=t(""),u=t(null),i=t(null),c=t(!1);let f=null,x=[];const $=t([]),v=t([]);L(async()=>{try{const l=await T("/users?role=user",{method:"GET"});$.value=l.data||[]}catch(l){console.error("Error fetching users",l)}}),R(()=>p.folderId,l=>{n.value=l}),R(S,async l=>{if(l)try{const e=await T(`/folders?user_id=${l}`,{method:"GET"});v.value=e.data||[],n.value=null}catch(e){console.error("Error fetching folders",e),v.value=[],n.value=null}else v.value=[],n.value=null});const A=async()=>{i.value=null;try{const l=await navigator.mediaDevices.getUserMedia({audio:!0});f=new MediaRecorder(l),x=[],f.ondataavailable=e=>{e.data.size>0&&x.push(e.data)},f.onstop=()=>{const e=new Blob(x,{type:"audio/webm"}),s=new File([e],"recorded_audio.webm",{type:"audio/webm"});u.value=s},f.start(),c.value=!0}catch(l){console.error("Error accessing microphone",l),l.name==="NotAllowedError"?i.value="تم رفض الإذن باستخدام الميكروفون. يرجى السماح به من إعدادات المتصفح.":l.name==="NotFoundError"?i.value="لم يتم العثور على ميكروفون متصل بالجهاز.":location.protocol!=="https:"?i.value="يجب أن يتم التسجيل من موقع يستخدم HTTPS.":i.value="حدث خطأ أثناء محاولة الوصول إلى الميكروفون."}},M=()=>{f&&c.value&&(f.stop(),c.value=!1)},h=l=>{const e=l.target.files[0];if(e){if(!e.type.startsWith("audio/")){i.value="الملف المرفوع يجب أن يكون صوتياً.";return}u.value=e,i.value=null}},E=()=>{C("update:isDrawerOpen",!1),z(()=>{var l,e;(l=_.value)==null||l.reset(),(e=_.value)==null||e.resetValidation(),p.folderId||(n.value=null),y.value="",b.value="",u.value=null,i.value=null,p.folderId||(v.value=[])})},G=()=>{var l;(l=_.value)==null||l.validate().then(({valid:e})=>{if(e){const s=new FormData;s.append("folder_id",n.value),s.append("word",y.value),s.append("translation",b.value),u.value&&s.append("audio_file",u.value),C("word-data",s),E()}})};return(l,e)=>{const s=K,H=J,N=Z;return m(),g(X,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":p.isDrawerOpen,"onUpdate:modelValue":e[5]||(e[5]=r=>C("update:isDrawerOpen",r))},{default:a(()=>[o(s,{title:"إضافة كلمة جديدة",onCancel:E}),o(Y),o(k(Q),{options:{wheelPropagation:!1}},{default:a(()=>[o(ee,{flat:""},{default:a(()=>[o(le,null,{default:a(()=>[o(oe,{ref_key:"refForm",ref:_,modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=r=>q.value=r),onSubmit:P(G,["prevent"])},{default:a(()=>[o(ae,null,{default:a(()=>[!p.folderId&&v.value.length?(m(),g(w,{key:0,cols:"12"},{default:a(()=>[o(H,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value=r),items:v.value.map(r=>({value:r.id,title:r.name})),label:"المجلد",rules:["requiredValidator"in l?l.requiredValidator:k(F)]},null,8,["modelValue","items","rules"])]),_:1})):I("",!0),o(w,{cols:"12"},{default:a(()=>[o(N,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=r=>y.value=r),label:"الكلمة",rules:["requiredValidator"in l?l.requiredValidator:k(F)]},null,8,["modelValue","rules"])]),_:1}),o(w,{cols:"12"},{default:a(()=>[o(N,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=r=>b.value=r),label:"الترجمة",rules:["requiredValidator"in l?l.requiredValidator:k(F)]},null,8,["modelValue","rules"])]),_:1}),o(w,{cols:"12"},{default:a(()=>[e[10]||(e[10]=d("div",{class:"mb-2 fw-bold"},"الصوت",-1)),d("div",re,[d("div",null,[e[6]||(e[6]=d("label",{class:"form-label"},"رفع ملف صوتي",-1)),d("input",{type:"file",accept:"audio/*",onChange:h,class:"form-control"},null,32)]),e[9]||(e[9]=d("div",{class:"text-center fw-bold"},"أو",-1)),d("div",te,[c.value?(m(),g(V,{key:1,variant:"outlined",color:"error",onClick:M},{default:a(()=>e[8]||(e[8]=[D(" إيقاف التسجيل ")])),_:1,__:[8]})):(m(),g(V,{key:0,variant:"outlined",color:"primary",onClick:A},{default:a(()=>e[7]||(e[7]=[D(" بدء التسجيل ")])),_:1,__:[7]})),u.value?(m(),U("div",ie,[d("audio",{src:l.URL.createObjectURL(u.value),controls:""},null,8,se),o(V,{icon:"",variant:"text",onClick:e[3]||(e[3]=()=>{u.value=null})},{default:a(()=>[o(W,{icon:"tabler-x"})]),_:1})])):c.value?I("",!0):(m(),U("div",ne," لم يتم اختيار أو تسجيل صوت بعد "))]),i.value?(m(),U("div",ue,j(i.value),1)):I("",!0)])]),_:1,__:[10]}),o(w,{cols:"12"},{default:a(()=>[o(V,{type:"submit",class:"me-3"},{default:a(()=>e[11]||(e[11]=[D(" حفظ ")])),_:1,__:[11]}),o(V,{type:"reset",variant:"tonal",color:"error",onClick:E},{default:a(()=>e[12]||(e[12]=[D(" إلغاء ")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{Ke as default};
