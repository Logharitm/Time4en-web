import{r as x,e as A}from"./validators-DpYrMFzk.js";import{r as p,u as N,i as M,a2 as P,w as U,a as E,c as G,o as T,b as t,e as r,d as i,l as e,G as w,t as m,s as h,ak as O,f as z,k as H,$ as K,a5 as J,F as Q,a3 as _,ax as W}from"./main-DrcHKvvT.js";import{_ as X}from"./AppTextField-C5oA4wiQ.js";import{u as C}from"./useGenerateImageVariant-qENq0vHz.js";import{a as Y,b as Z}from"./auth-v2-login-illustration-dark-DfSvbQ6F.js";import{m as ee,a as ae}from"./misc-mask-light-Bi5cOsdU.js";import{V as se}from"./VNodeRenderer-18CxFftF.js";import{$ as te}from"./api-RxDUwrL2.js";import{a as f,V as R}from"./VRow-DRCd4e6m.js";import{V as oe}from"./VImg-BM6eIrEi.js";import{V as re}from"./VCard-CwmXGZq3.js";import{V as D}from"./VCardText-D5solSbX.js";import{V as le}from"./VForm-B-_9_ZGE.js";import{V as ie}from"./VAlert-CkFPYV5n.js";import{V as ne}from"./VCheckbox-COrH99Nk.js";import"./helpers-DK5QwNv0.js";import"./form-Gacf3qss.js";import"./VTextField-BNWNe3y3.js";/* empty css                   */import"./VCounter-By8dHYUB.js";import"./VField-CtHXaUdx.js";import"./easing-Bybner-F.js";import"./VInput-D72zvfAv.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-3hKLDrM6.js";import"./VCheckboxBtn-DY_Bt8ST.js";import"./VSelectionControl-CXZYfD2x.js";const F="/build/assets/Logo-DteKpv2F.png",de={class:"auth-logo d-flex align-center gap-x-3"},ue={class:"auth-title"},me={class:"position-relative bg-background w-100 me-0"},pe={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ce=["src"],fe={class:"text-h4 mb-1"},ge={class:"text-capitalize"},ve={class:"text-error"},Ve={class:"d-flex align-center flex-wrap justify-space-between my-6"},he={class:"d-inline-block"},Qe={__name:"login",setup(be){const j=C(F,Z,F,Y,!0),q=C(ae,ee),g=p(!1),k=N(),y=M(),B=P(),n=p({email:void 0,password:void 0}),l=p(""),c=p(!1),$=p(),d=p({email:"",password:""}),b=p(!1),I=async()=>{var a;n.value={email:void 0,password:void 0},l.value="",c.value=!0;try{const s=await te("/login",{method:"POST",body:{email:d.value.email,password:d.value.password}}),o=(s==null?void 0:s.data)??s;if(!o.accessToken){l.value="Login failed. No access token received.";return}const v=o.accessToken,u=o.userData??{name:o.name,role:o.role,avatar:o.avatar??null,email:d.value.email};let V=[];u.role==="admin"?V=[{action:"manage",subject:"all"}]:V=[{action:"read",subject:"Home"}],_("accessToken").value=v,_("userData").value=u,_("userAbilityRules").value=V,B.update(V);const L=k.query.to?String(k.query.to):"/";y.currentRoute.value.fullPath!==L&&await W(()=>y.replace(L))}catch(s){if(console.error("Login error:",s),(a=s.response)!=null&&a._data){const o=s.response._data;o.message&&(l.value=o.message),o.errors&&Object.keys(o.errors).length>0&&(n.value={...n.value,...o.errors}),o.status==="error"&&o.message&&(l.value=o.message)}else s.message?l.value=s.message:l.value="Something went wrong, please try again."}finally{c.value=!1}},S=()=>{var a;n.value={email:void 0,password:void 0},l.value="",(a=$.value)==null||a.validate().then(({valid:s})=>{s&&I()})};return U([()=>d.value.email,()=>d.value.password],()=>{l.value&&(l.value=""),(n.value.email||n.value.password)&&(n.value={email:void 0,password:void 0})}),(a,s)=>{const o=E("RouterLink"),v=X;return T(),G(Q,null,[t(o,{to:"/"},{default:r(()=>[i("div",de,[t(e(se),{nodes:e(w).app.logo},null,8,["nodes"]),i("h1",ue,m(e(w).app.title),1)])]),_:1}),t(R,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:r(()=>[t(f,{md:"8",class:"d-none d-md-flex"},{default:r(()=>[i("div",me,[i("div",pe,[t(oe,{"max-width":"613",src:e(j),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),i("img",{class:"auth-footer-mask",src:e(q),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ce)])]),_:1}),t(f,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:r(()=>[t(re,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:r(()=>[t(D,null,{default:r(()=>[i("h4",fe,[h(m(a.$t("welcome_en"))+" ",1),i("span",ge,m(e(w).app.title),1)])]),_:1}),t(D,null,{default:r(()=>[t(e(le),{ref_key:"refVForm",ref:$,onSubmit:O(S,["prevent"])},{default:r(()=>[t(R,null,{default:r(()=>[t(f,{cols:"12"},{default:r(()=>[t(v,{modelValue:e(d).email,"onUpdate:modelValue":s[0]||(s[0]=u=>e(d).email=u),label:a.$t("email"),placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in a?a.requiredValidator:e(x),"emailValidator"in a?a.emailValidator:e(A)],"error-messages":e(n).email},null,8,["modelValue","label","rules","error-messages"])]),_:1}),t(f,{cols:"12"},{default:r(()=>[t(v,{modelValue:e(d).password,"onUpdate:modelValue":s[1]||(s[1]=u=>e(d).password=u),label:a.$t("password"),placeholder:"············",rules:["requiredValidator"in a?a.requiredValidator:e(x)],type:e(g)?"text":"password",autocomplete:"password","error-messages":e(n).password,"append-inner-icon":e(g)?"tabler-eye-off":"tabler-eye","onClick:appendInner":s[2]||(s[2]=u=>g.value=!e(g))},null,8,["modelValue","label","rules","type","error-messages","append-inner-icon"]),e(l)?(T(),z(ie,{key:0,color:"error",variant:"tonal",class:"mt-4"},{default:r(()=>[i("span",ve,m(e(l)),1)]),_:1})):H("",!0),i("div",Ve,[t(ne,{modelValue:e(b),"onUpdate:modelValue":s[3]||(s[3]=u=>K(b)?b.value=u:null),label:a.$t("remember_me")},null,8,["modelValue","label"]),t(o,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:r(()=>[h(m(a.$t("forget_password")),1)]),_:1})]),t(J,{block:"",type:"submit",loading:e(c),disabled:e(c)},{default:r(()=>[h(m(e(c)?a.$t("Register"):a.$t("Login")),1)]),_:1},8,["loading","disabled"])]),_:1}),t(f,{cols:"12",class:"text-center text-base"},{default:r(()=>[i("span",he,m(a.$t("dont have an account")),1),t(o,{class:"text-primary ms-1 d-inline-block",to:{name:"register"}},{default:r(()=>[h(m(a.$t("Sign up")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Qe as default};
