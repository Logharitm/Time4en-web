import{_ as ie}from"./TablePagination-CRBFnVtS.js";import{_ as ue}from"./AppDateTimePicker-DgTZGc2Y.js";import{_ as pe}from"./AppTextField-gvJhEt_e.js";import{_ as de}from"./AppSelect-kmsspWw3.js";import{r as s,E as me,w as ce,V as ve,c as fe,b as a,e as o,i as Ve,a as be,o as M,s as r,d as g,ae as k,Z as d,t as T,a_ as _e,l as ye,f as L,k as we}from"./main-0vQdum3W.js";import ge from"./AddSubscriptionDrawer-DFd3dvjD.js";import ke from"./EditSubscriptionDrawer-njuT6o8Z.js";import{$ as x}from"./api-Bu9cAkj7.js";import{V as Q,a as xe,b as Z,d as De}from"./VCard-B0FIEgQM.js";import{V as Ce}from"./VSnackbar-TQlPsty7.js";import{V as $e}from"./VDialog-CdInyGPO.js";import{V as j}from"./VCardText-2aUnYOFi.js";import{V as q}from"./VSpacer-offRCwAk.js";import{V as Se}from"./VDivider-BjTkQFeN.js";import{V as Te}from"./VDataTableServer-CxOuwh2A.js";import"./VPagination-B4h0j66t.js";import"./VField-ByueHOv2.js";import"./form-BOBDXTIA.js";import"./easing-Bybner-F.js";import"./VInput-DtWYPT_L.js";import"./VImg-DLx6417Q.js";import"./VTextField-Dt27vO3T.js";/* empty css                   */import"./VCounter-1kO9Ejq8.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-DLwBfv6o.js";import"./VList-glRgkQBq.js";import"./ssrBoot-BbTZXmIo.js";import"./VAvatar-CU2kuCTC.js";import"./dialog-transition-B9SqVvtS.js";import"./VMenu-Bp7x5C0S.js";import"./VOverlay-BbgNkXp-.js";import"./delay-C0XEdUdM.js";import"./lazy-Vb2e14Gv.js";import"./scopeId-BbZfvjVd.js";import"./VCheckboxBtn-B3MFNsTD.js";import"./VSelectionControl-DF6Do3EW.js";import"./VChip-cOQOpo1V.js";import"./VSlideGroup-_0PEsXoi.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./AppDrawerHeaderSection-CoC-5cXl.js";import"./vue3-perfect-scrollbar-DTesLCsq.js";import"./VNavigationDrawer-DkmwQRww.js";import"./VForm-ByJ2Ocas.js";import"./VRow-BJC749nL.js";/* empty css              */import"./index-CvOPxmL5.js";import"./VDataTable-BgskBfrg.js";import"./VTable-Br4jdXSn.js";import"./filter-dYckoemJ.js";const Ue={class:"me-3 d-flex gap-3"},Pe={style:{"min-width":"200px"}},Be={style:{"min-width":"200px"}},Ee={style:{"min-width":"200px"}},Ie=["onClick"],Et={__name:"index",setup(Oe){const N=Ve(),m=s(""),c=s(null),v=s(null),f=s(null),V=s(null),R=s([]),J=async()=>{try{const l=await x("/plans",{method:"GET"});R.value=l.data||[]}catch(l){console.error("Error fetching plans",l)}},i=s(10),u=s(1),U=s(),P=s(),F=s([]),K=l=>{var e,n;U.value=(e=l.sortBy[0])==null?void 0:e.key,P.value=(n=l.sortBy[0])==null?void 0:n.order},D=s(!1),G=s(""),C=s("success"),p=(l,e="success")=>{G.value=l,C.value=e,D.value=!0},b=s(!1),$=s(null),W=l=>{$.value=l,b.value=!0},X=async()=>{$.value&&(await ne($.value),b.value=!1,$.value=null)},Y=[{title:"اسم المستخدم",key:"user_name"},{title:"الباقة",key:"plan_name"},{title:"تاريخ البداية",key:"start_date"},{title:"تاريخ النهاية",key:"end_date"},{title:"الوقت المتبقي",key:"time_left"},{title:"الحالة",key:"status"},{title:"المبلغ المدفوع",key:"amount_paid"},{title:"العمليات",key:"actions",sortable:!1}],z=s([]),B=s(0),E=s(!0),_=async()=>{var l;E.value=!0;try{const e={search:m.value||void 0,plan_id:c.value||void 0,status:v.value||void 0,start_date:f.value||void 0,end_date:V.value||void 0,per_page:i.value,page:u.value,sort_by:U.value,sort_order:P.value},n=await x("/subscriptions",{method:"GET",params:e});n.status==="success"&&(z.value=n.data,B.value=((l=n.meta)==null?void 0:l.total)||0)}catch(e){console.error("Error fetching subscriptions",e)}finally{E.value=!1}},h=()=>{m.value="",c.value=null,v.value=null,f.value=null,V.value=null};me(()=>{J(),_()}),ce([m,c,v,f,V,i,u,U,P],_);const ee=ve(()=>z.value),te=l=>{const y=new Date(l)-new Date;if(y<=0)return"انتهى";const S=Math.floor(y/(1e3*60*60*24)),w=Math.floor(y/(1e3*60*60)%24);return`${S} يوم ${w} ساعة`},I=s(!1),O=s(!1),H=s(null),ae=l=>{H.value=l,O.value=!0},le=l=>N.push(`/admin/subscriptions/${l}`),oe=async l=>{try{await x("/subscriptions/store",{method:"POST",body:l}),p("تم إضافة الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ، حاول مرة أخرى","error")}},se=async(l,e)=>{try{await x(`/subscriptions/update/${l}`,{method:"POST",body:e}),p("تم تعديل الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ، حاول مرة أخرى","error")}},ne=async l=>{try{await x(`/subscriptions/delete/${l}`,{method:"POST"}),p("تم حذف الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ أثناء الحذف","error")}};return(l,e)=>{const n=de,y=pe,S=ue,w=be("IconBtn"),re=ie;return M(),fe("section",null,[a(Q,{class:"mb-6"},{default:o(()=>[a(xe,{class:"pb-4"},{default:o(()=>[a(Z,null,{default:o(()=>e[17]||(e[17]=[r("الاشتراكات")])),_:1,__:[17]})]),_:1}),a(j,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[g("div",Ue,[a(n,{label:"عرض","model-value":i.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=parseInt(t,10))},null,8,["model-value","items"])]),g("div",Pe,[a(y,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),placeholder:"بحث بالاسم",label:"اسم المستخدم"},null,8,["modelValue"])]),g("div",Be,[a(n,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),items:R.value,label:"الباقة","item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),g("div",Ee,[a(n,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),items:[{value:"active",title:"نشط"},{value:"expired",title:"منتهي"},{value:"canceled",title:"ملغى"}],label:"الحالة"},null,8,["modelValue"])]),a(S,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),label:"تاريخ البداية",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"]),a(S,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),label:"تاريخ النهاية",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"]),a(q),a(k,{"prepend-icon":"tabler-rotate-clockwise",onClick:h,variant:"outlined"},{default:o(()=>e[18]||(e[18]=[r(" إعادة تعيين ")])),_:1,__:[18]}),a(k,{"prepend-icon":"tabler-plus",onClick:e[6]||(e[6]=t=>I.value=!0)},{default:o(()=>e[19]||(e[19]=[r(" إضافة اشتراك جديد ")])),_:1,__:[19]})]),_:1}),a(Se),a(Te,{"items-per-page":i.value,"onUpdate:itemsPerPage":e[8]||(e[8]=t=>i.value=t),"model-value":F.value,"onUpdate:modelValue":e[9]||(e[9]=t=>F.value=t),page:u.value,"onUpdate:page":e[10]||(e[10]=t=>u.value=t),items:ee.value,"item-value":"id","items-length":B.value,headers:Y,class:"text-no-wrap",loading:E.value,"onUpdate:options":K},{"item.user_name":o(({item:t})=>[g("a",{onClick:_e(A=>ye(N).push(`/admin/users/${t.user.id}`),["prevent"]),class:"text-primary cursor-pointer"},T(t.user.name),9,Ie)]),"item.plan_name":o(({item:t})=>[r(T(t.plan.name),1)]),"item.time_left":o(({item:t})=>[r(T(te(t.end_date)),1)]),"item.actions":o(({item:t})=>[a(w,{onClick:A=>le(t.id)},{default:o(()=>[a(d,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),a(w,{onClick:A=>ae(t)},{default:o(()=>[a(d,{icon:"tabler-pencil"})]),_:2},1032,["onClick"]),a(w,{onClick:A=>W(t.id)},{default:o(()=>[a(d,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(re,{page:u.value,"onUpdate:page":e[7]||(e[7]=t=>u.value=t),"items-per-page":i.value,"total-items":B.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(ge,{"is-drawer-open":I.value,"onUpdate:isDrawerOpen":e[11]||(e[11]=t=>I.value=t),onPlanData:oe},null,8,["is-drawer-open"]),a(ke,{"is-drawer-open":O.value,"onUpdate:isDrawerOpen":e[12]||(e[12]=t=>O.value=t),"plan-data":H.value,onPlanData:se},null,8,["is-drawer-open","plan-data"]),a(Ce,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=t=>D.value=t),color:C.value,location:"top end",timeout:"5000"},{prepend:o(()=>[C.value==="success"?(M(),L(d,{key:0,icon:"tabler-check"})):C.value==="error"?(M(),L(d,{key:1,icon:"tabler-alert-circle"})):we("",!0)]),actions:o(()=>[a(k,{icon:"",variant:"text",color:"white",onClick:e[13]||(e[13]=t=>D.value=!1)},{default:o(()=>[a(d,{icon:"tabler-x"})]),_:1})]),default:o(()=>[r(" "+T(G.value)+" ",1)]),_:1},8,["modelValue","color"]),a($e,{modelValue:b.value,"onUpdate:modelValue":e[16]||(e[16]=t=>b.value=t),"max-width":"500px"},{default:o(()=>[a(Q,null,{default:o(()=>[a(Z,{class:"text-h6"},{default:o(()=>e[20]||(e[20]=[r("تأكيد الحذف")])),_:1,__:[20]}),a(j,null,{default:o(()=>e[21]||(e[21]=[r("هل أنت متأكد أنك تريد حذف هذا الاشتراك؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[21]}),a(De,{class:"px-6 pb-4"},{default:o(()=>[a(q),a(k,{color:"error",variant:"flat",onClick:e[15]||(e[15]=t=>b.value=!1)},{default:o(()=>e[22]||(e[22]=[r("إلغاء")])),_:1,__:[22]}),a(k,{color:"success",variant:"flat",onClick:X},{default:o(()=>e[23]||(e[23]=[r("موافق")])),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Et as default};
