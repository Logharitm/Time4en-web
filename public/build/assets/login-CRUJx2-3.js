import{r as T,e as A}from"./validators-DpYrMFzk.js";import{r as m,u as N,i as M,a2 as P,w as U,a as E,c as G,o as C,b as s,e as o,d as i,l as a,G as b,t as p,s as h,ak as O,f as z,k as H,$ as K,a5 as J,F as Q,a3 as w,ax as W}from"./main-CG3IkRSh.js";import{_ as X}from"./AppTextField-D7sjfavu.js";import{u as R}from"./useGenerateImageVariant-BsyrRYhA.js";import{a as Y,b as Z}from"./auth-v2-login-illustration-dark-DfSvbQ6F.js";import{m as ee,a as ae}from"./misc-mask-light-Bi5cOsdU.js";import{V as se}from"./VNodeRenderer-CXpD83TX.js";import{$ as te}from"./api-BiIk25cj.js";import{a as f,V as D}from"./VRow-Chmhbr5l.js";import{V as oe}from"./VImg-UsZZPD-J.js";import{V as re}from"./VCard-D708Umyd.js";import{V as F}from"./VCardText-B4D8XQzc.js";import{V as le}from"./VForm-MveYzDB4.js";import{V as ie}from"./VAlert-et19W1HI.js";import{V as ne}from"./VCheckbox-Bnwy2jKM.js";import"./helpers-DK5QwNv0.js";import"./form-0eVxL5IN.js";import"./VTextField-KavlJx_0.js";/* empty css                   */import"./VCounter-CQYIVEat.js";import"./VField-BIcgXvNc.js";import"./easing-Bybner-F.js";import"./VInput-DLn4gIuB.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-B9hrW8uR.js";import"./VCheckboxBtn-BTtL6pCD.js";import"./VSelectionControl-6Ze-_NSM.js";const j="/build/assets/Logo-DteKpv2F.png",de={class:"auth-logo d-flex align-center gap-x-3"},ue={class:"auth-title"},me={class:"position-relative bg-background w-100 me-0"},pe={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ce=["src"],fe={class:"text-h4 mb-1"},ge={class:"text-capitalize"},ve={class:"text-error"},Ve={class:"d-flex align-center flex-wrap justify-space-between my-6"},he={class:"d-inline-block"},Qe={__name:"login",setup(_e){const q=R(j,Z,j,Y,!0),B=R(ae,ee),g=m(!1),k=N(),y=M(),I=P(),n=m({email:void 0,password:void 0}),l=m(""),c=m(!1),x=m(),d=m({email:"",password:""}),_=m(!1),S=async()=>{var r;n.value={email:void 0,password:void 0},l.value="",c.value=!0;try{const e=await te("/login",{method:"POST",body:{email:d.value.email,password:d.value.password}}),t=(e==null?void 0:e.data)??e;if(!t.accessToken){l.value="Login failed. No access token received.";return}const v=t.accessToken,u=t.userData??{name:t.name,role:t.role,avatar:t.avatar??null,email:d.value.email};let V=[];u.role==="admin"?V=[{action:"manage",subject:"all"}]:V=[{action:"read",subject:"Home"}],w("accessToken").value=v,w("userData").value=u,w("userAbilityRules").value=V,I.update(V);const L=k.query.to?String(k.query.to):"/";y.currentRoute.value.fullPath!==L&&await W(()=>y.replace(L))}catch(e){if(console.error("Login error:",e),(r=e.response)!=null&&r._data){const t=e.response._data;t.message&&(l.value=t.message),t.errors&&Object.keys(t.errors).length>0&&(n.value={...n.value,...t.errors}),t.status==="error"&&t.message&&(l.value=t.message)}else e.message?l.value=e.message:l.value="Something went wrong, please try again."}finally{c.value=!1}},$=()=>{var r;n.value={email:void 0,password:void 0},l.value="",(r=x.value)==null||r.validate().then(({valid:e})=>{e&&S()})};return U([()=>d.value.email,()=>d.value.password],()=>{l.value&&(l.value=""),(n.value.email||n.value.password)&&(n.value={email:void 0,password:void 0})}),(r,e)=>{const t=E("RouterLink"),v=X;return C(),G(Q,null,[s(t,{to:"/"},{default:o(()=>[i("div",de,[s(a(se),{nodes:a(b).app.logo},null,8,["nodes"]),i("h1",ue,p(a(b).app.title),1)])]),_:1}),s(D,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[s(f,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[i("div",me,[i("div",pe,[s(oe,{"max-width":"613",src:a(q),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),i("img",{class:"auth-footer-mask",src:a(B),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ce)])]),_:1}),s(f,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[s(re,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:o(()=>[s(F,null,{default:o(()=>[i("h4",fe,[e[4]||(e[4]=h(" مرحبا بك في ")),i("span",ge,p(a(b).app.title),1)])]),_:1}),s(F,null,{default:o(()=>[s(a(le),{ref_key:"refVForm",ref:x,onSubmit:O($,["prevent"])},{default:o(()=>[s(D,null,{default:o(()=>[s(f,{cols:"12"},{default:o(()=>[s(v,{modelValue:a(d).email,"onUpdate:modelValue":e[0]||(e[0]=u=>a(d).email=u),label:"البريد الالكتروني",placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in r?r.requiredValidator:a(T),"emailValidator"in r?r.emailValidator:a(A)],"error-messages":a(n).email},null,8,["modelValue","rules","error-messages"])]),_:1}),s(f,{cols:"12"},{default:o(()=>[s(v,{modelValue:a(d).password,"onUpdate:modelValue":e[1]||(e[1]=u=>a(d).password=u),label:"كلمة المرور",placeholder:"············",rules:["requiredValidator"in r?r.requiredValidator:a(T)],type:a(g)?"text":"password",autocomplete:"password","error-messages":a(n).password,"append-inner-icon":a(g)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=u=>g.value=!a(g))},null,8,["modelValue","rules","type","error-messages","append-inner-icon"]),a(l)?(C(),z(ie,{key:0,color:"error",variant:"tonal",class:"mt-4"},{default:o(()=>[i("span",ve,p(a(l)),1)]),_:1})):H("",!0),i("div",Ve,[s(ne,{modelValue:a(_),"onUpdate:modelValue":e[3]||(e[3]=u=>K(_)?_.value=u:null),label:"تذكرني"},null,8,["modelValue"]),s(t,{class:"text-primary ms-2 mb-1",to:{name:"forgot-password"}},{default:o(()=>e[5]||(e[5]=[h(" هل نسيت كلمة المرور ؟ ")])),_:1,__:[5]})]),s(J,{block:"",type:"submit",loading:a(c),disabled:a(c)},{default:o(()=>[h(p(a(c)?"جاري تسجيل الدخول...":"تسجيل الدخول"),1)]),_:1},8,["loading","disabled"])]),_:1}),s(f,{cols:"12",class:"text-center text-base"},{default:o(()=>[i("span",he,p(r.$t("dont have an account")),1),s(t,{class:"text-primary ms-1 d-inline-block",to:{name:"register"}},{default:o(()=>[h(p(r.$t("Sign up")),1)]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Qe as default};
