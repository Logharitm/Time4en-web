import{_ as W}from"./AppTextField-BbzJIos3.js";import{_ as $}from"./AppDrawerHeaderSection-3seVS23W.js";import{aA as z,r as n,E as H,w as P,f as O,e as t,o as V,b as o,l as r,ak as Z,d as u,t as c,c as R,k as S,a5 as h,s as x,Z as G,ax as J}from"./main-BZ_AnTzS.js";import{C as K}from"./vue3-perfect-scrollbar-CTtPI7ic.js";import{V as Q}from"./VNavigationDrawer-BY5hm3Oq.js";import{V as X}from"./VDivider-DuTXF2R5.js";import{V as Y}from"./VCard-D7WIHSL4.js";import{V as ee}from"./VCardText-Dg5Ne-Sl.js";import{V as ae}from"./VForm-Dp3r4QnX.js";import{V as le,a as C}from"./VRow-DDeTC_EL.js";import"./form-BYLBrlPq.js";import"./VTextField--eVrj3Ew.js";/* empty css                   */import"./VCounter-DbZcoPwd.js";import"./VImg-XpaYwQe3.js";import"./VField-BSDXKIWv.js";import"./easing-Bybner-F.js";import"./VInput-BZojRirX.js";import"./forwardRefs-C-GTDzx5.js";import"./VSpacer-BjfYSwN-.js";/* empty css              */import"./VAvatar-DDJ1TBHl.js";import"./delay-BuRVU4Mv.js";import"./scopeId-PRLHRdYV.js";import"./ssrBoot-Bj6ESZ0-.js";const oe=["value"],te={class:"mb-2 fw-bold"},re={class:"d-flex flex-column gap-3"},ie={class:"form-label"},se={class:"text-center fw-bold"},ne={class:"d-flex gap-2 align-center"},de={key:2,class:"d-flex gap-2 align-center"},ue=["src"],ce={key:3,class:"text-muted small"},me={key:0,class:"text-danger small mt-1"},Me={__name:"EditWordDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},wordData:{type:Object,default:()=>({})},folderId:{type:Number,required:!0}},emits:["update:isDrawerOpen","submit-word"],setup(q,{emit:A}){const{t:l}=z(),s=q,F=A,B=n(!1),k=n(),p=n(!1),g=n(s.folderId),f=n(""),v=n(""),E=n(""),m=n(null),d=n(null),_=n(!1);let w=null,I=[];const y=n(null);H(()=>{var a;(a=s.wordData)!=null&&a.id&&(f.value=s.wordData.word||"",v.value=s.wordData.translation||"",E.value=s.wordData.example_sentence||"",s.wordData.folder_id&&(g.value=s.wordData.folder_id))}),P(()=>s.wordData,a=>{a&&Object.keys(a).length>0?(f.value=a.word||"",v.value=a.translation||"",E.value=a.example_sentence||"",a.folder_id&&(g.value=a.folder_id)):U()});const M=async()=>{d.value=null;try{const a=await navigator.mediaDevices.getUserMedia({audio:!0});w=new MediaRecorder(a),I=[],w.ondataavailable=e=>{e.data.size>0&&I.push(e.data)},w.onstop=()=>{const e=new Blob(I,{type:"audio/webm"}),b=new File([e],"recorded_audio.webm",{type:"audio/webm"});m.value=b},w.start(),_.value=!0}catch(a){console.error("Error accessing microphone",a),a.name==="NotAllowedError"?d.value=l("mic_permission_denied"):a.name==="NotFoundError"?d.value=l("mic_not_found"):location.protocol!=="https:"?d.value=l("https_required"):d.value=l("mic_error")}},T=()=>{w&&_.value&&(w.stop(),_.value=!1)},j=a=>{const e=a.target.files[0];if(e){if(!e.type.startsWith("audio/")){d.value=l("file_must_be_audio"),a.target.value="";return}m.value=e,d.value=null}},U=()=>{var a,e;(a=k.value)==null||a.reset(),(e=k.value)==null||e.resetValidation(),g.value=s.folderId,f.value="",v.value="",m.value=null,d.value=null,y.value&&(y.value.value=null),p.value=!1,_.value=!1},N=()=>{F("update:isDrawerOpen",!1),J(()=>U())},L=async()=>{var b,D;if(!await((b=k.value)==null?void 0:b.validate())||!((D=s.wordData)!=null&&D.id))return;const e=new FormData;e.append("folder_id",g.value),e.append("word",f.value),e.append("translation",v.value),m.value&&e.append("audio_file",m.value),p.value=!0;try{await F("submit-word",s.wordData.id,e),N()}catch(i){console.error(i)}finally{p.value=!1}};return(a,e)=>{const b=$,D=W;return V(),O(Q,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":s.isDrawerOpen,"onUpdate:modelValue":e[4]||(e[4]=i=>F("update:isDrawerOpen",i))},{default:t(()=>[o(b,{title:r(l)("edit_word"),onCancel:N},null,8,["title"]),o(X),o(r(K),{options:{wheelPropagation:!1}},{default:t(()=>[o(Y,{flat:""},{default:t(()=>[o(ee,null,{default:t(()=>[o(ae,{ref_key:"refForm",ref:k,modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=i=>B.value=i),onSubmit:Z(L,["prevent"])},{default:t(()=>[o(le,null,{default:t(()=>[u("input",{type:"hidden",value:g.value},null,8,oe),o(C,{cols:"12"},{default:t(()=>[o(D,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),label:r(l)("word"),rules:[i=>!!i||r(l)("required_field")]},null,8,["modelValue","label","rules"])]),_:1}),o(C,{cols:"12"},{default:t(()=>[o(D,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=i=>v.value=i),label:r(l)("translation"),rules:[i=>!!i||r(l)("required_field")]},null,8,["modelValue","label","rules"])]),_:1}),o(C,{cols:"12"},{default:t(()=>[u("div",te,c(r(l)("audio")),1),u("div",re,[u("div",null,[u("label",ie,c(r(l)("upload_audio")),1),u("input",{ref_key:"audioInput",ref:y,type:"file",accept:"audio/*",class:"form-control",onChange:j},null,544)]),u("div",se,c(r(l)("or")),1),u("div",ne,[_.value?(V(),O(h,{key:1,variant:"outlined",color:"error",onClick:T},{default:t(()=>[x(c(r(l)("stop_recording")),1)]),_:1})):(V(),O(h,{key:0,variant:"outlined",color:"primary",onClick:M},{default:t(()=>[x(c(r(l)("start_recording")),1)]),_:1})),m.value?(V(),R("div",de,[u("audio",{src:a.URL.createObjectURL(m.value),controls:""},null,8,ue),o(h,{icon:"",variant:"text",onClick:e[2]||(e[2]=()=>{m.value=null,y.value.value&&(y.value.value.value=null)})},{default:t(()=>[o(G,{icon:"tabler-x"})]),_:1})])):_.value?S("",!0):(V(),R("div",ce,c(r(l)("no_audio_selected")),1))]),d.value?(V(),R("div",me,c(d.value),1)):S("",!0)])]),_:1}),o(C,{cols:"12"},{default:t(()=>[o(h,{type:"submit",class:"me-3",loading:p.value,disabled:p.value},{default:t(()=>[x(c(p.value?r(l)("saving"):r(l)("save_changes")),1)]),_:1},8,["loading","disabled"]),o(h,{type:"reset",variant:"tonal",color:"error",onClick:N},{default:t(()=>[x(c(r(l)("cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{Me as default};
