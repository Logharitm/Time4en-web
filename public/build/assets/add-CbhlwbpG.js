import{_ as Ve}from"./TablePagination-CsKuvgpz.js";import{_ as ye}from"./AppDateTimePicker-Clg7izd1.js";import{_ as be}from"./AppTextField-bQg7W9yv.js";import{_ as xe}from"./AppSelect-CG4IKXjK.js";import{r as s,E as ke,w as q,V as we,c as H,b as a,e as o,i as he,a as J,o as B,s as i,d as u,a5 as y,t as p,Z as w,f as Y,k as Ce}from"./main-DNfLAd1v.js";import{$ as P}from"./api-CG0ResGa.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as K,a as De,b as W,d as Te}from"./VCard-BDIcrJ3p.js";import{V as Ae}from"./VSnackbar-B_yuGY2_.js";import{V as $e}from"./VDialog-CeKRzAZu.js";import{V as Q}from"./VCardText-Y7-FchBH.js";import{V as X}from"./VSpacer-sX-uJlrK.js";import{V as ee}from"./VDivider-a3hXnx_6.js";import{V as te}from"./VTextarea-Dbes9MqA.js";import{V as Ie}from"./VDataTableServer-B8yr_y21.js";import{V as Be}from"./VAvatar-CZFOTnPR.js";import{V as Pe}from"./VImg-BsFDuQT2.js";import{V as Ee}from"./VCheckbox-Co_xixli.js";import"./VPagination-MbRieGkT.js";import"./VField-vs5XHZ7e.js";import"./form-CfugG8qP.js";import"./easing-Bybner-F.js";import"./VInput-BXAyU4Wu.js";import"./VTextField-BmFH42NL.js";/* empty css                   */import"./VCounter-MWCAtdBt.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-CTwOu98Q.js";import"./VList-Bhm1Y8z5.js";import"./ssrBoot-C1TyBKNV.js";import"./dialog-transition-B1bqei82.js";import"./VMenu-BMVl-cXu.js";import"./VOverlay-C7pvaibH.js";import"./delay-BBJViIAp.js";import"./lazy-1Dv3bGuJ.js";import"./scopeId-D0odpr3K.js";import"./VCheckboxBtn-DeqLNsjG.js";import"./VSelectionControl-TafdbK98.js";import"./VChip-sbhdW3vd.js";import"./VSlideGroup-BL-GWpu-.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VDataTable-Cl8mTBzk.js";import"./VTable-BBq4vDoA.js";import"./filter-Gdvm0-1v.js";const Me={class:"me-3 d-flex gap-3"},Re={style:{"min-width":"200px"}},Se={style:{"min-width":"200px"}},Ne={style:{"min-width":"200px"}},ze={style:{"min-width":"200px"}},Fe={style:{"min-width":"200px"}},Le={class:"d-flex flex-column gap-3"},Ge={class:"d-flex gap-2 align-center"},Oe={class:"text-sm text-muted ms-3"},Ye={class:"d-flex align-center gap-x-4"},Qe={key:1},Ze={class:"d-flex flex-column"},je={class:"text-base"},qe={class:"text-sm"},He={class:"d-flex align-center gap-x-2"},Je={class:"text-capitalize text-high-emphasis text-body-1"},Ke={__name:"add",setup(We){const ae=he(),h=s(""),C=s(null),U=s(null),D=s(null),T=s(null),E=s([]),le=async()=>{var l;try{const e=await P("/plans",{method:"GET",params:{per_page:200}});e&&e.status==="success"?E.value=Array.isArray(e.data)?e.data:((l=e.data)==null?void 0:l.data)??e.data??[]:E.value=[]}catch(e){console.error("Error fetching plans",e),E.value=[]}},g=s(10),_=s(1),F=s(),L=s(),d=s([]),oe=l=>{var e,r,v,f;F.value=(r=(e=l.sortBy)==null?void 0:e[0])==null?void 0:r.key,L.value=(f=(v=l.sortBy)==null?void 0:v[0])==null?void 0:f.order},M=s(!1),Z=s(""),R=s("success"),m=(l,e="success")=>{Z.value=l,R.value=e,M.value=!0},A=s(!1),S=s(null),se=l=>{S.value=l,A.value=!0},re=async()=>{S.value&&(await fe(S.value),A.value=!1,S.value=null)},ne=l=>{if(!l)return"غير محدد";const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),e.getDate()),v=new Date(l),I=new Date(v.getFullYear(),v.getMonth(),v.getDate()).getTime()-r.getTime(),k=Math.ceil(I/(1e3*60*60*24));return k>0?`متبقي ${k} يوم`:k===0?"ينتهي اليوم":"منتهية"},b=s(""),x=s(""),$=s(!1),N=s([]),ie=async()=>{var l;if(N.value.length&&N.value.length===c.value)return N.value;try{$.value=!0;const e=c.value&&c.value>0?c.value:1e3,r=await P("/users",{method:"GET",params:{per_page:e,page:1}});if(r&&r.status==="success"){const f=(Array.isArray(r.data)?r.data:((l=r.data)==null?void 0:l.data)??r.data??[]).map(I=>I.id).filter(Boolean);return N.value=f,$.value=!1,f}else return $.value=!1,[]}catch(e){return console.error("Error fetching all user ids",e),$.value=!1,[]}},ue=async()=>{if(c.value<=V.value.length){d.value=V.value.map(e=>e.id),m(`تم تحديد ${d.value.length} مستخدم.`,"success");return}const l=await ie();l.length?(d.value=l,m(`تم تحديد جميع المستخدمين (${l.length}).`,"success")):(d.value=V.value.map(e=>e.id),m("لم أتمكن من جلب كل المستخدمين من السيرفر — تم تحديد المستخدمين في الصفحة الحالية فقط.","warning"))},de=()=>{d.value=[],m("تم إلغاء تحديد الكل","success")},me=async()=>{const l=d.value;if(!l||l.length===0){m("برجاء اختيار مستخدمين أولاً","error");return}if(!b.value||!b.value.trim()){m("برجاء كتابة نص الإشعار","error");return}if(!x.value||!x.value.trim()){m("برجاء كتابة نص الإشعار","error");return}try{await P("/notifications",{method:"POST",body:{user_ids:l,message:b.value.trim(),message_en:x.value.trim()}}),m("تم إرسال الإشعار بنجاح","success"),b.value=x.value=""}catch(e){console.error("Error sending notification",e),m("حدث خطأ أثناء إرسال الإشعار","error")}},ce=[{title:"",key:"select",sortable:!1},{title:"المستخدم",key:"user"},{title:"النوع",key:"role"},{title:"عدد الفولدرات",key:"folders",sortable:!1},{title:"عدد الكلمات",key:"words",sortable:!1},{title:"باقة الاشتراك",key:"plan"},{title:"بداية الاشتراك",key:"start_at"},{title:"نهاية الاشتراك",key:"expires_at"},{title:"الوقت المتبقي",key:"remain"}],V=s([]),c=s(0),G=s(!0),z=async()=>{var l;G.value=!0;try{const e={role:C.value||void 0,search:h.value||void 0,plan_id:U.value||void 0,start_date:D.value||void 0,end_date:T.value||void 0,per_page:g.value,page:_.value,sort_by:F.value||void 0,sort_order:L.value||void 0},r=await P("/users",{method:"GET",params:e});r&&r.status==="success"?(V.value=r.data,c.value=((l=r.meta)==null?void 0:l.total)||(Array.isArray(r.data)?r.data.length:0)):(V.value=[],c.value=0)}catch(e){console.error("Error fetching users",e),V.value=[],c.value=0}finally{G.value=!1}},pe=()=>{h.value="",C.value=null,U.value=null,D.value=null,T.value=null};ke(async()=>{await le(),z()}),q([h,C,U,D,T,g,F,L],()=>{_.value=1,z()}),q(_,()=>{z()});const ve=we(()=>V.value),O=l=>{const e=l==null?void 0:l.toLowerCase();return e==="subscriber"?{color:"success",icon:"tabler-user"}:e==="author"?{color:"error",icon:"tabler-device-desktop"}:e==="maintainer"?{color:"info",icon:"tabler-chart-pie"}:e==="editor"?{color:"warning",icon:"tabler-edit"}:e==="admin"?{color:"primary",icon:"tabler-crown"}:{color:"primary",icon:"tabler-user"}};s(null);const fe=async l=>{try{await P(`/users/delete/${l}`,{method:"POST"}),m("تم الحذف بنجاح","success"),z()}catch{m("حدث خطأ أثناء الحذف","error")}},ge=l=>{ae.push({name:"admin-users-id",params:{id:l}})};return(l,e)=>{const r=xe,v=be,f=ye,I=J("RouterLink"),k=J("IconBtn"),_e=Ve;return B(),H("section",null,[a(K,{class:"mb-6"},{default:o(()=>[a(De,{class:"pb-4"},{default:o(()=>[a(W,null,{default:o(()=>e[17]||(e[17]=[i("ارسال اشعار")])),_:1,__:[17]})]),_:1}),a(Q,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[u("div",Me,[a(r,{label:"عرض","model-value":g.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=parseInt(t,10))},null,8,["model-value","items"])]),u("div",Re,[a(v,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"بحث بالاسم أو الايميل",label:"بحث"},null,8,["modelValue"])]),u("div",Se,[a(r,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),items:[{value:"user",title:"مستخدم"},{value:"admin",title:"مدير"}],label:"النوع",clearable:""},null,8,["modelValue"])]),u("div",Ne,[a(r,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=t=>U.value=t),items:E.value,"item-value":"id","item-title":"name",label:"الباقة",clearable:"",placeholder:"اختر باقة"},null,8,["modelValue","items"])]),u("div",ze,[a(f,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),label:"تاريخ البداية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),u("div",Fe,[a(f,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=t=>T.value=t),label:"تاريخ النهاية",placeholder:"اختر التاريخ",clearable:""},null,8,["modelValue"])]),a(X),a(y,{"prepend-icon":"tabler-rotate-clockwise",variant:"outlined",onClick:pe},{default:o(()=>e[18]||(e[18]=[i(" إعادة تعيين ")])),_:1,__:[18]})]),_:1}),a(ee),a(Q,{class:"pb-2"},{default:o(()=>[u("div",Le,[a(te,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),label:"نص الإشعار",rows:"3",placeholder:"اكتب الإشعار هنا"},null,8,["modelValue"]),a(te,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=t=>x.value=t),label:"نص الاشعار بالانجليزية",rows:"3",placeholder:"اكتب الإشعار بالانجليزية هنا"},null,8,["modelValue"]),u("div",Ge,[a(y,{color:"primary",loading:!1,onClick:me},{default:o(()=>e[19]||(e[19]=[i(" إرسال الإشعار ")])),_:1,__:[19]}),a(y,{color:"success",variant:"outlined",loading:$.value,onClick:ue},{default:o(()=>e[20]||(e[20]=[i(" تحديد الكل ")])),_:1,__:[20]},8,["loading"]),a(y,{color:"error",variant:"outlined",onClick:de},{default:o(()=>e[21]||(e[21]=[i(" إلغاء التحديد ")])),_:1,__:[21]}),u("div",Oe,p(d.value.length)+" مختار ",1)])])]),_:1}),a(ee),a(Ie,{"items-per-page":g.value,"onUpdate:itemsPerPage":e[10]||(e[10]=t=>g.value=t),"model-value":d.value,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value=t),page:_.value,"onUpdate:page":e[12]||(e[12]=t=>_.value=t),items:ve.value,"item-value":"id","items-length":c.value,headers:ce,class:"text-no-wrap",loading:G.value,"onUpdate:options":oe},{"item.select":o(({item:t})=>[a(Ee,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=n=>d.value=n),value:t.id,density:"compact","hide-details":""},null,8,["modelValue","value"])]),"item.user":o(({item:t})=>[u("div",Ye,[a(Be,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:O(t.role).color},{default:o(()=>{var n;return[t.avatar?(B(),Y(Pe,{key:0,src:t.avatar},null,8,["src"])):(B(),H("span",Qe,p((n=t.name)==null?void 0:n.charAt(0).toUpperCase()),1))]}),_:2},1032,["variant","color"]),u("div",Ze,[u("h6",je,[a(I,{to:{name:"apps-user-view-id",params:{id:t.id}},class:"font-weight-medium text-link"},{default:o(()=>[i(p(t.name),1)]),_:2},1032,["to"])]),u("div",qe,p(t.email),1)])])]),"item.role":o(({item:t})=>[u("div",He,[a(w,{size:22,icon:O(t.role).icon,color:O(t.role).color},null,8,["icon","color"]),u("div",Je,p(t.role=="user"?"عميل":"ادمن"),1)])]),"item.plan":o(({item:t})=>{var n,j;return[i(p(((j=(n=t.subscription)==null?void 0:n.plan)==null?void 0:j.name)||"غير مشترك"),1)]}),"item.start_at":o(({item:t})=>{var n;return[i(p(((n=t.subscription)==null?void 0:n.start_date)??"غير محدد"),1)]}),"item.expires_at":o(({item:t})=>{var n;return[i(p(((n=t.subscription)==null?void 0:n.end_date)??"غير محدد"),1)]}),"item.remain":o(({item:t})=>{var n;return[i(p(ne((n=t.subscription)==null?void 0:n.end_date)),1)]}),"item.actions":o(({item:t})=>[a(k,{onClick:n=>se(t.id)},{default:o(()=>[a(w,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a(k,{onClick:n=>ge(t.id)},{default:o(()=>[a(w,{icon:"tabler-eye"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(_e,{page:_.value,"onUpdate:page":e[9]||(e[9]=t=>_.value=t),"items-per-page":g.value,"total-items":c.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Ae,{modelValue:M.value,"onUpdate:modelValue":e[14]||(e[14]=t=>M.value=t),color:R.value,location:"top end",timeout:"5000"},{prepend:o(()=>[R.value==="success"?(B(),Y(w,{key:0,icon:"tabler-check"})):R.value==="error"?(B(),Y(w,{key:1,icon:"tabler-alert-circle"})):Ce("",!0)]),actions:o(()=>[a(y,{icon:"",variant:"text",color:"white",onClick:e[13]||(e[13]=t=>M.value=!1)},{default:o(()=>[a(w,{icon:"tabler-x"})]),_:1})]),default:o(()=>[i(" "+p(Z.value)+" ",1)]),_:1},8,["modelValue","color"]),a($e,{modelValue:A.value,"onUpdate:modelValue":e[16]||(e[16]=t=>A.value=t),"max-width":"500px"},{default:o(()=>[a(K,null,{default:o(()=>[a(W,{class:"text-h6"},{default:o(()=>e[22]||(e[22]=[i(" تأكيد الحذف ")])),_:1,__:[22]}),a(Q,null,{default:o(()=>e[23]||(e[23]=[i("هل أنت متأكد أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[23]}),a(Te,{class:"px-6 pb-4"},{default:o(()=>[a(X),a(y,{color:"error",variant:"flat",onClick:e[15]||(e[15]=t=>A.value=!1)},{default:o(()=>e[24]||(e[24]=[i(" إلغاء ")])),_:1,__:[24]}),a(y,{color:"success",variant:"flat",onClick:re},{default:o(()=>e[25]||(e[25]=[i(" موافق ")])),_:1,__:[25]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Yt=Ue(Ke,[["__scopeId","data-v-07608f66"]]);export{Yt as default};
