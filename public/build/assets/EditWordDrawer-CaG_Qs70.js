import{_ as q}from"./AppTextField-BxDveB7d.js";import{_ as H}from"./AppDrawerHeaderSection-BbvAOMj6.js";import{r as i,E as L,w as P,f as N,e as t,o as w,b as l,l as W,ak as $,d as n,c as O,k as I,a5 as y,s as g,Z as z,t as S,ax as Z}from"./main-BPya9C_m.js";import{C as G}from"./vue3-perfect-scrollbar-Bl6vwOcg.js";import{V as J}from"./VNavigationDrawer-B8RTjSoX.js";import{V as K}from"./VDivider-B7hdumJl.js";import{V as Q}from"./VCard-k9DIWO39.js";import{V as X}from"./VCardText-Co93LYzR.js";import{V as Y}from"./VForm-B_jSqMjE.js";import{V as ee,a as k}from"./VRow-Cbs66xzv.js";import"./form-BNeh-56c.js";import"./VTextField-BoMqGRBo.js";/* empty css                   */import"./VCounter-D4Y8La9P.js";import"./VImg-BPIMXBFo.js";import"./VField-DL3VmOu6.js";import"./easing-Bybner-F.js";import"./VInput-Dtz-Ek0R.js";import"./forwardRefs-C-GTDzx5.js";import"./VSpacer-CCZQE-6d.js";/* empty css              */import"./VAvatar-B1fgSqvX.js";import"./delay-CfIYthrV.js";import"./scopeId-Cb922vc8.js";import"./ssrBoot-kdGnx6BA.js";const ae=["value"],le={class:"d-flex flex-column gap-3"},te={class:"d-flex gap-2 align-center"},oe={key:2,class:"d-flex gap-2 align-center"},re=["src"],ie={key:3,class:"text-muted small"},se={key:0,class:"text-danger small mt-1"},Se={__name:"EditWordDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},wordData:{type:Object,default:()=>({})},folderId:{type:Number,required:!0}},emits:["update:isDrawerOpen","submit-word"],setup(U,{emit:T}){const r=U,x=T,R=i(!1),D=i(),d=i(!1),_=i(r.folderId),m=i(""),p=i(""),B=i(""),u=i(null),s=i(null),f=i(!1);let v=null,C=[];const V=i(null);L(()=>{var a;(a=r.wordData)!=null&&a.id&&(m.value=r.wordData.word||"",p.value=r.wordData.translation||"",B.value=r.wordData.example_sentence||"",r.wordData.folder_id&&(_.value=r.wordData.folder_id))}),P(()=>r.wordData,a=>{a&&Object.keys(a).length>0?(m.value=a.word||"",p.value=a.translation||"",B.value=a.example_sentence||"",a.folder_id&&(_.value=a.folder_id)):E()});const A=async()=>{s.value=null;try{const a=await navigator.mediaDevices.getUserMedia({audio:!0});v=new MediaRecorder(a),C=[],v.ondataavailable=e=>{e.data.size>0&&C.push(e.data)},v.onstop=()=>{const e=new Blob(C,{type:"audio/webm"}),c=new File([e],"recorded_audio.webm",{type:"audio/webm"});u.value=c},v.start(),f.value=!0}catch(a){console.error("Error accessing microphone",a),a.name==="NotAllowedError"?s.value="تم رفض الإذن باستخدام الميكروفون. يرجى السماح به من إعدادات المتصفح.":a.name==="NotFoundError"?s.value="لم يتم العثور على ميكروفون متصل بالجهاز.":location.protocol!=="https:"?s.value="يجب أن يتم التسجيل من موقع يستخدم HTTPS.":s.value="حدث خطأ أثناء محاولة الوصول إلى الميكروفون."}},M=()=>{v&&f.value&&(v.stop(),f.value=!1)},j=a=>{const e=a.target.files[0];if(e){if(!e.type.startsWith("audio/")){s.value="الملف يجب أن يكون صوتياً",a.target.value="";return}u.value=e,s.value=null}},E=()=>{var a,e;(a=D.value)==null||a.reset(),(e=D.value)==null||e.resetValidation(),_.value=r.folderId,m.value="",p.value="",u.value=null,s.value=null,V.value&&(V.value.value=null),d.value=!1,f.value=!1},F=()=>{x("update:isDrawerOpen",!1),Z(()=>E())},h=async()=>{var c,b;if(!await((c=D.value)==null?void 0:c.validate())||!((b=r.wordData)!=null&&b.id))return;const e=new FormData;e.append("folder_id",_.value),e.append("word",m.value),e.append("translation",p.value),u.value&&e.append("audio_file",u.value),d.value=!0;try{await x("submit-word",r.wordData.id,e),F()}catch(o){console.error(o)}finally{d.value=!1}};return(a,e)=>{const c=H,b=q;return w(),N(J,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":r.isDrawerOpen,"onUpdate:modelValue":e[4]||(e[4]=o=>x("update:isDrawerOpen",o))},{default:t(()=>[l(c,{title:"تعديل الكلمة",onCancel:F}),l(K),l(W(G),{options:{wheelPropagation:!1}},{default:t(()=>[l(Q,{flat:""},{default:t(()=>[l(X,null,{default:t(()=>[l(Y,{ref_key:"refForm",ref:D,modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=o=>R.value=o),onSubmit:$(h,["prevent"])},{default:t(()=>[l(ee,null,{default:t(()=>[n("input",{type:"hidden",value:_.value},null,8,ae),l(k,{cols:"12"},{default:t(()=>[l(b,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),label:"الكلمة",rules:[o=>!!o||"هذا الحقل مطلوب"]},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12"},{default:t(()=>[l(b,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o),label:"الترجمة",rules:[o=>!!o||"هذا الحقل مطلوب"]},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12"},{default:t(()=>[e[9]||(e[9]=n("div",{class:"mb-2 fw-bold"},"الصوت",-1)),n("div",le,[n("div",null,[e[5]||(e[5]=n("label",{class:"form-label"},"رفع ملف صوتي",-1)),n("input",{ref_key:"audioInput",ref:V,type:"file",accept:"audio/*",class:"form-control",onChange:j},null,544)]),e[8]||(e[8]=n("div",{class:"text-center fw-bold"},"أو",-1)),n("div",te,[f.value?(w(),N(y,{key:1,variant:"outlined",color:"error",onClick:M},{default:t(()=>e[7]||(e[7]=[g(" إيقاف التسجيل ")])),_:1,__:[7]})):(w(),N(y,{key:0,variant:"outlined",color:"primary",onClick:A},{default:t(()=>e[6]||(e[6]=[g(" بدء التسجيل ")])),_:1,__:[6]})),u.value?(w(),O("div",oe,[n("audio",{src:a.URL.createObjectURL(u.value),controls:""},null,8,re),l(y,{icon:"",variant:"text",onClick:e[2]||(e[2]=()=>{u.value=null,V.value.value&&(V.value.value.value=null)})},{default:t(()=>[l(z,{icon:"tabler-x"})]),_:1})])):f.value?I("",!0):(w(),O("div",ie," لم يتم اختيار أو تسجيل صوت بعد "))]),s.value?(w(),O("div",se,S(s.value),1)):I("",!0)])]),_:1,__:[9]}),l(k,{cols:"12"},{default:t(()=>[l(y,{type:"submit",class:"me-3",loading:d.value,disabled:d.value},{default:t(()=>[g(S(d.value?"جاري الحفظ...":"حفظ التعديل"),1)]),_:1},8,["loading","disabled"]),l(y,{type:"reset",variant:"tonal",color:"error",onClick:F},{default:t(()=>e[10]||(e[10]=[g(" إلغاء ")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{Se as default};
