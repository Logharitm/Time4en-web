import{_ as de}from"./TablePagination-ZScbOXhw.js";import{_ as pe}from"./AppDateTimePicker-CIxv6jGN.js";import{_ as ve}from"./AppTextField-DBlO8Lxp.js";import{_ as ce}from"./AppSelect-CSE9LxVJ.js";import{r as o,E as fe,w as ye,V as _e,c as Ve,b as a,e as n,i as be,a as we,o as F,s as u,d as m,a5 as I,Z as f,t as G,ak as ge,l as ke,f as J,k as xe}from"./main-3Ek2-vqO.js";import Pe from"./AddPaymentDrawer-0B5mH25p.js";import Ce from"./EditPaymentDrawer-C39eClCD.js";import{$ as D}from"./api-BpTJh5AM.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as K,a as $e,b as L,d as Te}from"./VCard-Cy2610jn.js";import{V as Ue}from"./VSnackbar-Dg7xeQFC.js";import{V as Be}from"./VDialog-B306eGQE.js";import{V as W}from"./VCardText-nKy8O0sN.js";import{V as X}from"./VSpacer-AMIDYQfe.js";import{V as Ee}from"./VDivider-CNJ0JAF3.js";import{V as Se}from"./VDataTableServer-ClhvR6m_.js";import"./VPagination-DCY6lhPK.js";import"./VField-BZO07n5Y.js";import"./form-BFft6bF4.js";import"./easing-Bybner-F.js";import"./VInput-eqrI1Tb8.js";import"./VImg-DHEG49XA.js";import"./VTextField-BlJtMEl3.js";/* empty css                   */import"./VCounter-D4mnuWok.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-D8lNyzyW.js";import"./VList-DRSip7cL.js";import"./ssrBoot-DLxkxOYb.js";import"./VAvatar-PjWKY9Zo.js";import"./dialog-transition-DOzjCuna.js";import"./VMenu-CO_tTOVB.js";import"./VOverlay-BmFxMlce.js";import"./delay-Bh9Ow0lC.js";import"./lazy-Bdw_h9vk.js";import"./scopeId-BrhiY3MR.js";import"./VCheckboxBtn-DYbUdoTq.js";import"./VSelectionControl-zf8MxbzQ.js";import"./VChip-BRBhOMN6.js";import"./VSlideGroup-DJ9KPXKW.js";import"./AppDrawerHeaderSection-_P0tiKxi.js";import"./vue3-perfect-scrollbar-BVPqh9CI.js";import"./VNavigationDrawer-Cnd4S-a5.js";import"./VForm-YI1HS6zq.js";import"./VRow-DgDEmKs1.js";/* empty css              */import"./index-CvOPxmL5.js";import"./VDataTable-C2cz77jX.js";import"./VTable-QFl8yaek.js";import"./filter-DtdNYXmH.js";const he={class:"me-3 d-flex gap-3"},Ie={style:{"min-width":"200px"}},Ae={style:{"min-width":"180px"}},Oe={style:{"min-width":"160px"}},Ne={style:{"min-width":"160px"}},Me=["onClick"],Re={__name:"index",setup(Fe){const z=be(),y=o(""),_=o(null),V=o(null),b=o(null),w=o(null),g=o(null),$=o([]),Y=async()=>{var l;try{const e=await D("/plans",{method:"GET",params:{per_page:200}});e&&e.status==="success"?$.value=Array.isArray(e.data)?e.data:((l=e.data)==null?void 0:l.data)??e.data??[]:$.value=[]}catch(e){console.error("Error fetching plans",e),$.value=[]}},d=o(10),p=o(1),A=o(),O=o(),T=o([]),ee=l=>{var e,s,r,i;A.value=(s=(e=l.sortBy)==null?void 0:e[0])==null?void 0:s.key,O.value=(i=(r=l.sortBy)==null?void 0:r[0])==null?void 0:i.order},U=o(!1),Q=o(""),B=o("success"),v=(l,e="success")=>{Q.value=l,B.value=e,U.value=!0},k=o(!1),E=o(null),te=l=>{E.value=l,k.value=!0},ae=async()=>{E.value&&(await ie(E.value),k.value=!1,E.value=null)},le=[{title:"المستخدم",key:"user_name"},{title:"الباقة",key:"plan_name"},{title:"المبلغ",key:"amount"},{title:"طريقة الدفع",key:"payment_method"},{title:"الحالة",key:"status"},{title:"تاريخ الدفع",key:"paid_at"}],S=o([]),x=o(0),N=o(!0),P=async()=>{var l;N.value=!0;try{const e={search:y.value||void 0,plan_id:_.value||void 0,status:V.value||void 0,payment_method:b.value||void 0,paid_from:w.value||void 0,paid_to:g.value||void 0,per_page:d.value,page:p.value,sort_by:A.value||void 0,sort_order:O.value||void 0},s=await D("/payments",{method:"GET",params:e});s&&s.status==="success"?(S.value=(s.data||[]).map(r=>{var i,c,h,t;return{...r,user_name:((c=(i=r.subscription)==null?void 0:i.user)==null?void 0:c.name)??r.user_name??"-",plan_name:((t=(h=r.subscription)==null?void 0:h.plan)==null?void 0:t.name)??r.plan_name??"-"}}),x.value=((l=s.meta)==null?void 0:l.total)||0):(S.value=[],x.value=0)}catch(e){console.error("Error fetching payments",e),S.value=[],x.value=0}finally{N.value=!1}};fe(async()=>{await Y(),P()}),ye([y,_,V,b,w,g,d,p,A,O],()=>{p.value=1,P()});const oe=_e(()=>S.value),Z=o(!1),ne=async l=>{try{await D("/payments/store",{method:"POST",body:l}),v("تم إضافة الدفع بنجاح","success"),P()}catch{v("حدث خطأ، حاول مرة أخرى","error")}},M=o(!1),j=o(null),se=l=>{j.value=l,M.value=!0},re=async(l,e)=>{try{await D(`/payments/update/${l}`,{method:"POST",body:e}),v("تم تعديل الدفع بنجاح","success"),P()}catch{v("حدث خطأ، حاول مرة أخرى","error")}},ie=async l=>{try{await D(`/payments/delete/${l}`,{method:"POST"});const e=T.value.findIndex(s=>s===l);e!==-1&&T.value.splice(e,1),v("تم حذف الدفع بنجاح","success"),P()}catch{v("حدث خطأ أثناء الحذف","error")}},ue=l=>{z.push(`/admin/subscriptions/${l}`)},me=()=>{y.value="",_.value=null,V.value=null,b.value=null,w.value=null,g.value=null};return(l,e)=>{const s=ce,r=ve,i=pe,c=we("IconBtn"),h=de;return F(),Ve("section",null,[a(K,{class:"mb-6"},{default:n(()=>[a($e,{class:"pb-4"},{default:n(()=>[a(L,null,{default:n(()=>e[17]||(e[17]=[u("المدفوعات")])),_:1,__:[17]})]),_:1}),a(W,{class:"d-flex flex-wrap gap-4 align-center"},{default:n(()=>[m("div",he,[a(s,{label:"عرض","model-value":d.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=parseInt(t,10))},null,8,["model-value","items"])]),m("div",Ie,[a(r,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"بحث باسم المستخدم",label:"بحث"},null,8,["modelValue"])]),m("div",Ae,[a(s,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),items:$.value,"item-value":"id","item-title":"name",label:"الباقة",clearable:"",placeholder:"اختر باقة"},null,8,["modelValue","items"])]),m("div",Oe,[a(s,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),items:[{value:"pending",title:"قيد الانتظار"},{value:"completed",title:"مكتمل"},{value:"failed",title:"فشل"}],"item-value":"value","item-title":"title",label:"الحالة",clearable:"",placeholder:"اختر حالة"},null,8,["modelValue"])]),m("div",Ne,[a(s,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),items:[{value:"credit_card",title:"بطاقة ائتمان"},{value:"bank_transfer",title:"تحويل بنكي"},{value:"paypal",title:"باي بال"},{value:"cash",title:"نقداً"}],"item-value":"value","item-title":"title",label:"طريقة الدفع",clearable:"",placeholder:"اختر طريقة"},null,8,["modelValue"])]),m("div",null,[a(i,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),label:"تاريخ الدفع من",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"])]),m("div",null,[a(i,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t),label:"تاريخ الدفع إلى",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"])]),a(X),a(I,{"prepend-icon":"tabler-rotate-clockwise",onClick:me,variant:"outlined"},{default:n(()=>e[18]||(e[18]=[u(" إعادة تعيين ")])),_:1,__:[18]})]),_:1}),a(Ee),a(Se,{"items-per-page":d.value,"onUpdate:itemsPerPage":e[8]||(e[8]=t=>d.value=t),"model-value":T.value,"onUpdate:modelValue":e[9]||(e[9]=t=>T.value=t),page:p.value,"onUpdate:page":e[10]||(e[10]=t=>p.value=t),items:oe.value,"item-value":"id","items-length":x.value,headers:le,class:"text-no-wrap",loading:N.value,"onUpdate:options":ee},{"item.user_name":n(({item:t})=>[m("a",{onClick:ge(R=>{var C,q,H;return ke(z).push(`/admin/users/${((q=(C=t.subscription)==null?void 0:C.user)==null?void 0:q.id)??((H=t.subscription)==null?void 0:H.user_id)}`)},["prevent"]),class:"text-primary cursor-pointer"},G(t.user_name),9,Me)]),"item.plan_name":n(({item:t})=>[u(G(t.plan_name),1)]),"item.actions":n(({item:t})=>[a(c,{onClick:R=>{var C;return ue((C=t.subscription)==null?void 0:C.id)}},{default:n(()=>[a(f,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),a(c,{onClick:R=>se(t)},{default:n(()=>[a(f,{icon:"tabler-pencil"})]),_:2},1032,["onClick"]),a(c,{onClick:R=>te(t.id)},{default:n(()=>[a(f,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),bottom:n(()=>[a(h,{page:p.value,"onUpdate:page":e[7]||(e[7]=t=>p.value=t),"items-per-page":d.value,"total-items":x.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Pe,{"is-drawer-open":Z.value,"onUpdate:isDrawerOpen":e[11]||(e[11]=t=>Z.value=t),onPlanData:ne},null,8,["is-drawer-open"]),a(Ce,{"is-drawer-open":M.value,"onUpdate:isDrawerOpen":e[12]||(e[12]=t=>M.value=t),"plan-data":j.value,onPlanData:re},null,8,["is-drawer-open","plan-data"]),a(Ue,{modelValue:U.value,"onUpdate:modelValue":e[14]||(e[14]=t=>U.value=t),color:B.value,location:"top end",timeout:"5000"},{prepend:n(()=>[B.value==="success"?(F(),J(f,{key:0,icon:"tabler-check"})):B.value==="error"?(F(),J(f,{key:1,icon:"tabler-alert-circle"})):xe("",!0)]),actions:n(()=>[a(I,{icon:"",variant:"text",color:"white",onClick:e[13]||(e[13]=t=>U.value=!1)},{default:n(()=>[a(f,{icon:"tabler-x"})]),_:1})]),default:n(()=>[u(" "+G(Q.value)+" ",1)]),_:1},8,["modelValue","color"]),a(Be,{modelValue:k.value,"onUpdate:modelValue":e[16]||(e[16]=t=>k.value=t),"max-width":"500px"},{default:n(()=>[a(K,null,{default:n(()=>[a(L,{class:"text-h6"},{default:n(()=>e[19]||(e[19]=[u("تأكيد الحذف")])),_:1,__:[19]}),a(W,null,{default:n(()=>e[20]||(e[20]=[u("هل أنت متأكد أنك تريد حذف هذا الدفع؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[20]}),a(Te,{class:"px-6 pb-4"},{default:n(()=>[a(X),a(I,{color:"error",variant:"flat",onClick:e[15]||(e[15]=t=>k.value=!1)},{default:n(()=>e[21]||(e[21]=[u("إلغاء")])),_:1,__:[21]}),a(I,{color:"success",variant:"flat",onClick:ae},{default:n(()=>e[22]||(e[22]=[u("موافق")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Nt=De(Re,[["__scopeId","data-v-5a929cf6"]]);export{Nt as default};
