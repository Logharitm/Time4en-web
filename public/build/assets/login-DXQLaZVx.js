import{r as T,e as N}from"./validators-DpYrMFzk.js";import{r as m,u as S,i as M,a2 as P,w as U,a as E,c as G,o as $,b as o,e as r,d,l as e,G as b,t as c,s as C,ak as O,f as z,k as H,$ as K,a5 as J,F as Q,a3 as w,ay as W}from"./main-D7GZrFPc.js";import{_ as X}from"./AppTextField-B5LmAI45.js";import{u as R}from"./useGenerateImageVariant-CzF67hkD.js";import{a as Y,b as Z}from"./auth-v2-login-illustration-dark-BzQLVLl3.js";import{m as ee,a as ae}from"./misc-mask-light-Cs9lWxjH.js";import{V as se}from"./VNodeRenderer-CjDMbrzl.js";import{$ as te}from"./api-BeHJEbM3.js";import{a as V,V as x}from"./VRow-vQlp5R9K.js";import{V as oe}from"./VImg-BKWqwFT8.js";import{V as re}from"./VCard-DT64k4Cz.js";import{V as D}from"./VCardText-CefwAUfD.js";import{V as le}from"./VForm-hfu_i-lW.js";import{V as ie}from"./VAlert-DxfXpoSX.js";import{V as ne}from"./VCheckbox-oZtik6Zu.js";import"./helpers-DK5QwNv0.js";import"./form-oozAywB0.js";import"./VTextField-DRRTeVyU.js";/* empty css                   */import"./VCounter-36TneYEq.js";import"./VField-Dtz92r7N.js";import"./easing-Bybner-F.js";import"./VInput-DMUQC4_n.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-BLMjzrgb.js";import"./VCheckboxBtn-5Z1sZGey.js";import"./VSelectionControl-C9fnzau3.js";const F="/assets/Logo-DteKpv2F.png",ue={class:"auth-logo d-flex align-center gap-x-3"},de={class:"auth-title"},me={class:"position-relative bg-background w-100 me-0"},pe={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ce=["src"],fe={class:"text-h4 mb-1"},ge={class:"text-capitalize"},ve={class:"text-error"},Ve={class:"d-flex align-center flex-wrap justify-space-between my-6"},Je={__name:"login",setup(he){const j=R(F,Z,F,Y,!0),q=R(ae,ee),f=m(!1),_=S(),k=M(),B=P(),i=m({email:void 0,password:void 0}),l=m(""),p=m(!1),y=m(),n=m({email:"",password:""}),h=m(!1),I=async()=>{var s;i.value={email:void 0,password:void 0},l.value="",p.value=!0;try{const a=await te("/login",{method:"POST",body:{email:n.value.email,password:n.value.password}}),t=(a==null?void 0:a.data)??a;if(!t.accessToken){l.value="Login failed. No access token received.";return}if(t.role!=="admin")return;const g=t.accessToken,u=t.userData??{name:t.name,role:t.role,avatar:t.avatar??null,email:n.value.email};let v=[];u.role==="admin"?v=[{action:"manage",subject:"all"}]:v=[{action:"read",subject:"Home"}],w("accessToken").value=g,w("userData").value=u,w("userAbilityRules").value=v,B.update(v);const L=_.query.to?String(_.query.to):"/";k.currentRoute.value.fullPath!==L&&await W(()=>k.replace(L))}catch(a){if(console.error("Login error:",a),(s=a.response)!=null&&s._data){const t=a.response._data;t.message&&(l.value=t.message),t.errors&&Object.keys(t.errors).length>0&&(i.value={...i.value,...t.errors}),t.status==="error"&&t.message&&(l.value=t.message)}else a.message?l.value=a.message:l.value="Something went wrong, please try again."}finally{p.value=!1}},A=()=>{var s;i.value={email:void 0,password:void 0},l.value="",(s=y.value)==null||s.validate().then(({valid:a})=>{a&&I()})};return U([()=>n.value.email,()=>n.value.password],()=>{l.value&&(l.value=""),(i.value.email||i.value.password)&&(i.value={email:void 0,password:void 0})}),(s,a)=>{const t=E("RouterLink"),g=X;return $(),G(Q,null,[o(t,{to:"/"},{default:r(()=>[d("div",ue,[o(e(se),{nodes:e(b).app.logo},null,8,["nodes"]),d("h1",de,c(e(b).app.title),1)])]),_:1}),o(x,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:r(()=>[o(V,{md:"8",class:"d-none d-md-flex"},{default:r(()=>[d("div",me,[d("div",pe,[o(oe,{"max-width":"613",src:e(j),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),d("img",{class:"auth-footer-mask",src:e(q),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ce)])]),_:1}),o(V,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:r(()=>[o(re,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-4"},{default:r(()=>[o(D,null,{default:r(()=>[d("h4",fe,[C(c(s.$t("welcome_en"))+" ",1),d("span",ge,c(e(b).app.title),1)])]),_:1}),o(D,null,{default:r(()=>[o(e(le),{ref_key:"refVForm",ref:y,onSubmit:O(A,["prevent"])},{default:r(()=>[o(x,null,{default:r(()=>[o(V,{cols:"12"},{default:r(()=>[o(g,{modelValue:e(n).email,"onUpdate:modelValue":a[0]||(a[0]=u=>e(n).email=u),label:s.$t("email"),placeholder:"johndoe@email.com",type:"email",autofocus:"",rules:["requiredValidator"in s?s.requiredValidator:e(T),"emailValidator"in s?s.emailValidator:e(N)],"error-messages":e(i).email},null,8,["modelValue","label","rules","error-messages"])]),_:1}),o(V,{cols:"12"},{default:r(()=>[o(g,{modelValue:e(n).password,"onUpdate:modelValue":a[1]||(a[1]=u=>e(n).password=u),label:s.$t("password"),placeholder:"············",rules:["requiredValidator"in s?s.requiredValidator:e(T)],type:e(f)?"text":"password",autocomplete:"password","error-messages":e(i).password,"append-inner-icon":e(f)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=u=>f.value=!e(f))},null,8,["modelValue","label","rules","type","error-messages","append-inner-icon"]),e(l)?($(),z(ie,{key:0,color:"error",variant:"tonal",class:"mt-4"},{default:r(()=>[d("span",ve,c(e(l)),1)]),_:1})):H("",!0),d("div",Ve,[o(ne,{modelValue:e(h),"onUpdate:modelValue":a[3]||(a[3]=u=>K(h)?h.value=u:null),label:s.$t("remember_me")},null,8,["modelValue","label"])]),o(J,{block:"",type:"submit",loading:e(p),disabled:e(p)},{default:r(()=>[C(c(e(p)?s.$t("Register"):s.$t("Login")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Je as default};
