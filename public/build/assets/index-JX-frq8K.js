import{_ as ie}from"./TablePagination-CsKuvgpz.js";import{_ as ue}from"./AppDateTimePicker-Clg7izd1.js";import{_ as pe}from"./AppTextField-bQg7W9yv.js";import{_ as de}from"./AppSelect-CG4IKXjK.js";import{r as s,E as me,w as ce,V as ve,c as fe,b as a,e as o,i as Ve,a as be,o as A,s as r,d as g,a5 as S,Z as d,t as T,ak as _e,l as ye,f as H,k as we}from"./main-DNfLAd1v.js";import ge from"./AddSubscriptionDrawer-BWrnIJkw.js";import ke from"./EditSubscriptionDrawer-DLm3OoNd.js";import{$ as k}from"./api-CG0ResGa.js";import{V as L,a as xe,b as Q,d as De}from"./VCard-BDIcrJ3p.js";import{V as Ce}from"./VSnackbar-B_yuGY2_.js";import{V as $e}from"./VDialog-CeKRzAZu.js";import{V as Z}from"./VCardText-Y7-FchBH.js";import{V as j}from"./VSpacer-sX-uJlrK.js";import{V as Se}from"./VDivider-a3hXnx_6.js";import{V as Te}from"./VDataTableServer-B8yr_y21.js";import"./VPagination-MbRieGkT.js";import"./VField-vs5XHZ7e.js";import"./form-CfugG8qP.js";import"./easing-Bybner-F.js";import"./VInput-BXAyU4Wu.js";import"./VImg-BsFDuQT2.js";import"./VTextField-BmFH42NL.js";/* empty css                   */import"./VCounter-MWCAtdBt.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-CTwOu98Q.js";import"./VList-Bhm1Y8z5.js";import"./ssrBoot-C1TyBKNV.js";import"./VAvatar-CZFOTnPR.js";import"./dialog-transition-B1bqei82.js";import"./VMenu-BMVl-cXu.js";import"./VOverlay-C7pvaibH.js";import"./delay-BBJViIAp.js";import"./lazy-1Dv3bGuJ.js";import"./scopeId-D0odpr3K.js";import"./VCheckboxBtn-DeqLNsjG.js";import"./VSelectionControl-TafdbK98.js";import"./VChip-sbhdW3vd.js";import"./VSlideGroup-BL-GWpu-.js";import"./validators-DpYrMFzk.js";import"./helpers-DK5QwNv0.js";import"./AppDrawerHeaderSection-gpZOQQAI.js";import"./vue3-perfect-scrollbar-i8rGr49W.js";import"./VNavigationDrawer-BG_KtqUH.js";import"./VForm-2E3Px0Nj.js";import"./VRow-BSHRD7Gb.js";/* empty css              */import"./index-CvOPxmL5.js";import"./VDataTable-Cl8mTBzk.js";import"./VTable-BBq4vDoA.js";import"./filter-Gdvm0-1v.js";const Ue={class:"me-3 d-flex gap-3"},Pe={style:{"min-width":"200px"}},Be={style:{"min-width":"200px"}},Ee={style:{"min-width":"200px"}},Ie=["onClick"],Et={__name:"index",setup(Oe){const M=Ve(),m=s(""),c=s(null),v=s(null),f=s(null),V=s(null),N=s([]),q=async()=>{try{const l=await k("/plans",{method:"GET"});N.value=l.data||[]}catch(l){console.error("Error fetching plans",l)}},i=s(10),u=s(1),U=s(),P=s(),h=s([]),J=l=>{var e,n;U.value=(e=l.sortBy[0])==null?void 0:e.key,P.value=(n=l.sortBy[0])==null?void 0:n.order},x=s(!1),R=s(""),D=s("success"),p=(l,e="success")=>{R.value=l,D.value=e,x.value=!0},b=s(!1),C=s(null),K=l=>{C.value=l,b.value=!0},W=async()=>{C.value&&(await ne(C.value),b.value=!1,C.value=null)},X=[{title:"اسم المستخدم",key:"user_name"},{title:"الباقة",key:"plan_name"},{title:"تاريخ البداية",key:"start_date"},{title:"تاريخ النهاية",key:"end_date"},{title:"الوقت المتبقي",key:"time_left"},{title:"الحالة",key:"status"},{title:"المبلغ المدفوع",key:"amount_paid"}],F=s([]),B=s(0),E=s(!0),_=async()=>{var l;E.value=!0;try{const e={search:m.value||void 0,plan_id:c.value||void 0,status:v.value||void 0,start_date:f.value||void 0,end_date:V.value||void 0,per_page:i.value,page:u.value,sort_by:U.value,sort_order:P.value},n=await k("/subscriptions",{method:"GET",params:e});n.status==="success"&&(F.value=n.data,B.value=((l=n.meta)==null?void 0:l.total)||0)}catch(e){console.error("Error fetching subscriptions",e)}finally{E.value=!1}},Y=()=>{m.value="",c.value=null,v.value=null,f.value=null,V.value=null};me(()=>{q(),_()}),ce([m,c,v,f,V,i,u,U,P],_);const ee=ve(()=>F.value),te=l=>{const y=new Date(l)-new Date;if(y<=0)return"انتهى";const $=Math.floor(y/(1e3*60*60*24)),w=Math.floor(y/(1e3*60*60)%24);return`${$} يوم ${w} ساعة`},G=s(!1),I=s(!1),z=s(null),ae=l=>{z.value=l,I.value=!0},le=l=>M.push(`/admin/subscriptions/${l}`),oe=async l=>{try{await k("/subscriptions/store",{method:"POST",body:l}),p("تم إضافة الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ، حاول مرة أخرى","error")}},se=async(l,e)=>{try{await k(`/subscriptions/update/${l}`,{method:"POST",body:e}),p("تم تعديل الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ، حاول مرة أخرى","error")}},ne=async l=>{try{await k(`/subscriptions/delete/${l}`,{method:"POST"}),p("تم حذف الاشتراك بنجاح","success"),_()}catch{p("حدث خطأ أثناء الحذف","error")}};return(l,e)=>{const n=de,y=pe,$=ue,w=be("IconBtn"),re=ie;return A(),fe("section",null,[a(L,{class:"mb-6"},{default:o(()=>[a(xe,{class:"pb-4"},{default:o(()=>[a(Q,null,{default:o(()=>e[16]||(e[16]=[r("الاشتراكات")])),_:1,__:[16]})]),_:1}),a(Z,{class:"d-flex flex-wrap gap-4 align-center"},{default:o(()=>[g("div",Ue,[a(n,{label:"عرض","model-value":i.value,items:[10,25,50,100].map(t=>({value:t,title:t})),style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=parseInt(t,10))},null,8,["model-value","items"])]),g("div",Pe,[a(y,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),placeholder:"بحث بالاسم",label:"اسم المستخدم"},null,8,["modelValue"])]),g("div",Be,[a(n,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),items:N.value,label:"الباقة","item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),g("div",Ee,[a(n,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),items:[{value:"active",title:"نشط"},{value:"expired",title:"منتهي"},{value:"canceled",title:"ملغى"}],label:"الحالة"},null,8,["modelValue"])]),a($,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),label:"تاريخ البداية",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"]),a($,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),label:"تاريخ النهاية",placeholder:"اختر التاريخ",style:{"min-width":"200px"},clearable:""},null,8,["modelValue"]),a(j),a(S,{"prepend-icon":"tabler-rotate-clockwise",onClick:Y,variant:"outlined"},{default:o(()=>e[17]||(e[17]=[r(" إعادة تعيين ")])),_:1,__:[17]})]),_:1}),a(Se),a(Te,{"items-per-page":i.value,"onUpdate:itemsPerPage":e[7]||(e[7]=t=>i.value=t),"model-value":h.value,"onUpdate:modelValue":e[8]||(e[8]=t=>h.value=t),page:u.value,"onUpdate:page":e[9]||(e[9]=t=>u.value=t),items:ee.value,"item-value":"id","items-length":B.value,headers:X,class:"text-no-wrap",loading:E.value,"onUpdate:options":J},{"item.user_name":o(({item:t})=>[g("a",{onClick:_e(O=>ye(M).push(`/admin/users/${t.user.id}`),["prevent"]),class:"text-primary cursor-pointer"},T(t.user.name),9,Ie)]),"item.plan_name":o(({item:t})=>[r(T(t.plan.name),1)]),"item.time_left":o(({item:t})=>[r(T(te(t.end_date)),1)]),"item.actions":o(({item:t})=>[a(w,{onClick:O=>le(t.id)},{default:o(()=>[a(d,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),a(w,{onClick:O=>ae(t)},{default:o(()=>[a(d,{icon:"tabler-pencil"})]),_:2},1032,["onClick"]),a(w,{onClick:O=>K(t.id)},{default:o(()=>[a(d,{icon:"tabler-trash"})]),_:2},1032,["onClick"])]),bottom:o(()=>[a(re,{page:u.value,"onUpdate:page":e[6]||(e[6]=t=>u.value=t),"items-per-page":i.value,"total-items":B.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(ge,{"is-drawer-open":G.value,"onUpdate:isDrawerOpen":e[10]||(e[10]=t=>G.value=t),onPlanData:oe},null,8,["is-drawer-open"]),a(ke,{"is-drawer-open":I.value,"onUpdate:isDrawerOpen":e[11]||(e[11]=t=>I.value=t),"plan-data":z.value,onPlanData:se},null,8,["is-drawer-open","plan-data"]),a(Ce,{modelValue:x.value,"onUpdate:modelValue":e[13]||(e[13]=t=>x.value=t),color:D.value,location:"top end",timeout:"5000"},{prepend:o(()=>[D.value==="success"?(A(),H(d,{key:0,icon:"tabler-check"})):D.value==="error"?(A(),H(d,{key:1,icon:"tabler-alert-circle"})):we("",!0)]),actions:o(()=>[a(S,{icon:"",variant:"text",color:"white",onClick:e[12]||(e[12]=t=>x.value=!1)},{default:o(()=>[a(d,{icon:"tabler-x"})]),_:1})]),default:o(()=>[r(" "+T(R.value)+" ",1)]),_:1},8,["modelValue","color"]),a($e,{modelValue:b.value,"onUpdate:modelValue":e[15]||(e[15]=t=>b.value=t),"max-width":"500px"},{default:o(()=>[a(L,null,{default:o(()=>[a(Q,{class:"text-h6"},{default:o(()=>e[18]||(e[18]=[r("تأكيد الحذف")])),_:1,__:[18]}),a(Z,null,{default:o(()=>e[19]||(e[19]=[r("هل أنت متأكد أنك تريد حذف هذا الاشتراك؟ لا يمكن التراجع عن هذا الإجراء.")])),_:1,__:[19]}),a(De,{class:"px-6 pb-4"},{default:o(()=>[a(j),a(S,{color:"error",variant:"flat",onClick:e[14]||(e[14]=t=>b.value=!1)},{default:o(()=>e[20]||(e[20]=[r("إلغاء")])),_:1,__:[20]}),a(S,{color:"success",variant:"flat",onClick:W},{default:o(()=>e[21]||(e[21]=[r("موافق")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Et as default};
