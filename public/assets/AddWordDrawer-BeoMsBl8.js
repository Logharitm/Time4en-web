import{r as x}from"./validators-DpYrMFzk.js";import{cx as j,r as s,E as z,w as U,f as D,e as t,o as f,b as a,l as r,ak as H,k as I,d as p,t as u,c as q,a5 as b,s as C,Z,ay as J}from"./main-D7GZrFPc.js";import{_ as K}from"./AppTextField-B5LmAI45.js";import{_ as Q}from"./AppSelect-CGoPXjiF.js";import{_ as X}from"./AppDrawerHeaderSection-B0imzD_d.js";import{C as Y}from"./vue3-perfect-scrollbar-0fVAVACI.js";import{$ as B}from"./api-BeHJEbM3.js";import{V as ee}from"./VNavigationDrawer-CzYrM_bp.js";import{V as oe}from"./VDivider-wc9HqgK5.js";import{V as ae}from"./VCard-DT64k4Cz.js";import{V as le}from"./VCardText-CefwAUfD.js";import{V as te}from"./VForm-hfu_i-lW.js";import{V as re,a as y}from"./VRow-vQlp5R9K.js";import"./helpers-DK5QwNv0.js";import"./form-oozAywB0.js";import"./VTextField-DRRTeVyU.js";/* empty css                   */import"./VCounter-36TneYEq.js";import"./VImg-BKWqwFT8.js";import"./VField-Dtz92r7N.js";import"./easing-Bybner-F.js";import"./VInput-DMUQC4_n.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-AMYQbzZG.js";import"./VList-F9p1vbvQ.js";import"./ssrBoot-BVP4G8eg.js";import"./VAvatar-BLMjzrgb.js";import"./dialog-transition-Cnq99lTQ.js";import"./VMenu-CA2MFpOx.js";import"./VOverlay-BG3xaAKI.js";import"./delay-DQPnD_CU.js";import"./lazy-DF7vD1w0.js";import"./scopeId-BZ6pJ2T2.js";import"./VCheckboxBtn-5Z1sZGey.js";import"./VSelectionControl-C9fnzau3.js";import"./VChip-udoLMTLN.js";import"./VSlideGroup-BYMKBCqk.js";import"./VSpacer-CeMEN20F.js";/* empty css              */import"./index-CvOPxmL5.js";const ie={class:"mb-2 fw-bold"},se={class:"d-flex flex-column gap-3"},ne={class:"form-label"},de={class:"text-center fw-bold"},ue={class:"d-flex gap-2 align-center"},me={key:2,class:"d-flex gap-2 align-center"},ce=["src"],pe={key:3,class:"text-muted small"},fe={key:0,class:"text-danger small mt-1"},ao={__name:"AddWordDrawer",props:{isDrawerOpen:{type:Boolean,required:!0},folderId:{type:Number,default:null}},emits:["update:isDrawerOpen","word-data"],setup(O,{emit:S}){const{t:l,locale:ve}=j(),v=O,E=S,A=s(!1),g=s(),T=s(null),m=s(v.folderId),h=s(""),k=s(""),c=s(null),n=s(null),w=s(!1);let V=null,F=[];const $=s([]),_=s([]);z(async()=>{try{const e=await B("/users?role=user",{method:"GET"});$.value=e.data||[]}catch(e){console.error("Error fetching users",e)}}),U(()=>v.folderId,e=>{m.value=e}),U(T,async e=>{if(e)try{const o=await B(`/folders?user_id=${e}`,{method:"GET"});_.value=o.data||[],m.value=null}catch(o){console.error("Error fetching folders",o),_.value=[],m.value=null}else _.value=[],m.value=null});const M=async()=>{n.value=null;try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});V=new MediaRecorder(e),F=[],V.ondataavailable=o=>{o.data.size>0&&F.push(o.data)},V.onstop=()=>{const o=new Blob(F,{type:"audio/webm"}),d=new File([o],"recorded_audio.webm",{type:"audio/webm"});c.value=d},V.start(),w.value=!0}catch(e){console.error("Error accessing microphone",e),e.name==="NotAllowedError"?n.value=l("micPermissionDenied"):e.name==="NotFoundError"?n.value=l("micNotFound"):location.protocol!=="https:"?n.value=l("httpsRequired"):n.value=l("micAccessError")}},W=()=>{V&&w.value&&(V.stop(),w.value=!1)},G=e=>{const o=e.target.files[0];if(o){if(!o.type.startsWith("audio/")){n.value=l("fileMustBeAudio");return}c.value=o,n.value=null}},R=()=>{E("update:isDrawerOpen",!1),J(()=>{var e,o;(e=g.value)==null||e.reset(),(o=g.value)==null||o.resetValidation(),v.folderId||(m.value=null),h.value="",k.value="",c.value=null,n.value=null,v.folderId||(_.value=[])})},L=()=>{var e;(e=g.value)==null||e.validate().then(({valid:o})=>{if(o){const d=new FormData;d.append("folder_id",m.value),d.append("word",h.value),d.append("translation",k.value),c.value&&d.append("audio_file",c.value),E("word-data",d),R()}})};return(e,o)=>{const d=X,P=Q,N=K;return f(),D(ee,{temporary:"",width:400,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":o[5]||(o[5]=i=>E("update:isDrawerOpen",i))},{default:t(()=>[a(d,{title:r(l)("addWord"),onCancel:R},null,8,["title"]),a(oe),a(r(Y),{options:{wheelPropagation:!1}},{default:t(()=>[a(ae,{flat:""},{default:t(()=>[a(le,null,{default:t(()=>[a(te,{ref_key:"refForm",ref:g,modelValue:A.value,"onUpdate:modelValue":o[4]||(o[4]=i=>A.value=i),onSubmit:H(L,["prevent"])},{default:t(()=>[a(re,null,{default:t(()=>[!v.folderId&&_.value.length?(f(),D(y,{key:0,cols:"12"},{default:t(()=>[a(P,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=i=>m.value=i),items:_.value.map(i=>({value:i.id,title:i.name})),label:r(l)("folder"),rules:["requiredValidator"in e?e.requiredValidator:r(x)]},null,8,["modelValue","items","label","rules"])]),_:1})):I("",!0),a(y,{cols:"12"},{default:t(()=>[a(N,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=i=>h.value=i),label:r(l)("word"),rules:["requiredValidator"in e?e.requiredValidator:r(x)]},null,8,["modelValue","label","rules"])]),_:1}),a(y,{cols:"12"},{default:t(()=>[a(N,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=i=>k.value=i),label:r(l)("translation"),rules:["requiredValidator"in e?e.requiredValidator:r(x)]},null,8,["modelValue","label","rules"])]),_:1}),a(y,{cols:"12"},{default:t(()=>[p("div",ie,u(r(l)("audio")),1),p("div",se,[p("div",null,[p("label",ne,u(r(l)("uploadAudio")),1),p("input",{type:"file",accept:"audio/*",onChange:G,class:"form-control"},null,32)]),p("div",de,u(r(l)("or")),1),p("div",ue,[w.value?(f(),D(b,{key:1,variant:"outlined",color:"error",onClick:W},{default:t(()=>[C(u(r(l)("stopRecording")),1)]),_:1})):(f(),D(b,{key:0,variant:"outlined",color:"primary",onClick:M},{default:t(()=>[C(u(r(l)("startRecording")),1)]),_:1})),c.value?(f(),q("div",me,[p("audio",{src:e.URL.createObjectURL(c.value),controls:""},null,8,ce),a(b,{icon:"",variant:"text",onClick:o[3]||(o[3]=()=>{c.value=null})},{default:t(()=>[a(Z,{icon:"tabler-x"})]),_:1})])):w.value?I("",!0):(f(),q("div",pe,u(r(l)("noAudioSelected")),1))]),n.value?(f(),q("div",fe,u(n.value),1)):I("",!0)])]),_:1}),a(y,{cols:"12"},{default:t(()=>[a(b,{type:"submit",class:"me-3"},{default:t(()=>[C(u(r(l)("save")),1)]),_:1}),a(b,{type:"reset",variant:"tonal",color:"error",onClick:R},{default:t(()=>[C(u(r(l)("cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}};export{ao as default};
